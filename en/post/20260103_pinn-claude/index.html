

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>imulation of a Two-Dimensional Cylinder Wake by Claude - </title>

  <meta name="description" content="Introduction
Around this time last year, I spent two months working on a simulation of a two-dimensional cylindrical wake using PINNs. I hadn&rsquo;t finished working on this article.
This time, since I built a new Python development environment, I decided to tackle this theme as an example project, with Claude as my companion.
Code Generation
Prompt
I had Claude generate the source code using the following prompt.
Please generate PyTorch-based code to simulate the wake flow behind a two-dimensional cylinder using PINN.
Generated code
import torch
import torch.nn as nn
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.animation import FuncAnimation
from tqdm import tqdm

# デバイスの設定
device = torch.device(&#39;cuda&#39; if torch.cuda.is_available() else &#39;cpu&#39;)
print(f&#34;Using device: {device}&#34;)

# ニューラルネットワークの定義
class PINN(nn.Module):
    def __init__(self, layers):
        super(PINN, self).__init__()
        self.layers = nn.ModuleList()
        
        for i in range(len(layers) - 1):
            self.layers.append(nn.Linear(layers[i], layers[i&#43;1]))
            
    def forward(self, x, y, t):
        # 入力の正規化
        inputs = torch.cat([x, y, t], dim=1)
        
        for i in range(len(self.layers) - 1):
            inputs = torch.tanh(self.layers[i](inputs))
        
        # 最終層(活性化関数なし)
        output = self.layers[-1](inputs)
        
        # 速度と圧力を出力
        u = output[:, 0:1]  # x方向速度
        v = output[:, 1:2]  # y方向速度
        p = output[:, 2:3]  # 圧力
        
        return u, v, p

# Navier-Stokes方程式の残差計算
class NavierStokesPINN:
    def __init__(self, layers, Re=100):
        self.model = PINN(layers).to(device)
        self.Re = Re  # レイノルズ数
        self.nu = 1.0 / Re  # 動粘性係数
        
        # 最適化アルゴリズム
        self.optimizer = torch.optim.Adam(self.model.parameters(), lr=1e-3)
        self.scheduler = torch.optim.lr_scheduler.StepLR(
            self.optimizer, step_size=5000, gamma=0.9
        )
        
        self.loss_history = []
        
    def net_NS(self, x, y, t):
        &#34;&#34;&#34;Navier-Stokes方程式の残差を計算&#34;&#34;&#34;
        x.requires_grad_(True)
        y.requires_grad_(True)
        t.requires_grad_(True)
        
        u, v, p = self.model(x, y, t)
        
        # 1階微分
        u_x = torch.autograd.grad(u, x, grad_outputs=torch.ones_like(u), 
                                   create_graph=True)[0]
        u_y = torch.autograd.grad(u, y, grad_outputs=torch.ones_like(u), 
                                   create_graph=True)[0]
        u_t = torch.autograd.grad(u, t, grad_outputs=torch.ones_like(u), 
                                   create_graph=True)[0]
        
        v_x = torch.autograd.grad(v, x, grad_outputs=torch.ones_like(v), 
                                   create_graph=True)[0]
        v_y = torch.autograd.grad(v, y, grad_outputs=torch.ones_like(v), 
                                   create_graph=True)[0]
        v_t = torch.autograd.grad(v, t, grad_outputs=torch.ones_like(v), 
                                   create_graph=True)[0]
        
        p_x = torch.autograd.grad(p, x, grad_outputs=torch.ones_like(p), 
                                   create_graph=True)[0]
        p_y = torch.autograd.grad(p, y, grad_outputs=torch.ones_like(p), 
                                   create_graph=True)[0]
        
        # 2階微分
        u_xx = torch.autograd.grad(u_x, x, grad_outputs=torch.ones_like(u_x), 
                                    create_graph=True)[0]
        u_yy = torch.autograd.grad(u_y, y, grad_outputs=torch.ones_like(u_y), 
                                    create_graph=True)[0]
        
        v_xx = torch.autograd.grad(v_x, x, grad_outputs=torch.ones_like(v_x), 
                                    create_graph=True)[0]
        v_yy = torch.autograd.grad(v_y, y, grad_outputs=torch.ones_like(v_y), 
                                    create_graph=True)[0]
        
        # Navier-Stokes方程式(運動量保存則)
        f_u = u_t &#43; u * u_x &#43; v * u_y &#43; p_x - self.nu * (u_xx &#43; u_yy)
        f_v = v_t &#43; u * v_x &#43; v * v_y &#43; p_y - self.nu * (v_xx &#43; v_yy)
        
        # 連続の式(質量保存則)
        f_cont = u_x &#43; v_y
        
        return f_u, f_v, f_cont, u, v, p
    
    def loss_function(self, x_domain, y_domain, t_domain,
                     x_inlet, y_inlet, t_inlet,
                     x_outlet, y_outlet, t_outlet,
                     x_wall_top, y_wall_top, t_wall_top,
                     x_wall_bottom, y_wall_bottom, t_wall_bottom,
                     x_cylinder, y_cylinder, t_cylinder,
                     x_init, y_init, t_init):
        &#34;&#34;&#34;損失関数の計算&#34;&#34;&#34;
        
        # 領域内でのNavier-Stokes方程式の残差
        f_u, f_v, f_cont, _, _, _ = self.net_NS(x_domain, y_domain, t_domain)
        loss_pde = torch.mean(f_u**2) &#43; torch.mean(f_v**2) &#43; torch.mean(f_cont**2)
        
        # 入口境界条件(一様流)
        u_inlet, v_inlet, _ = self.model(x_inlet, y_inlet, t_inlet)
        loss_inlet = torch.mean((u_inlet - 1.0)**2) &#43; torch.mean(v_inlet**2)
        
        # 出口境界条件(圧力ゼロ、速度の勾配ゼロに近似)
        u_outlet, v_outlet, p_outlet = self.model(x_outlet, y_outlet, t_outlet)
        loss_outlet = torch.mean(p_outlet**2)
        
        # 上下壁境界条件(自由滑り)
        u_wall_t, v_wall_t, _ = self.model(x_wall_top, y_wall_top, t_wall_top)
        u_wall_b, v_wall_b, _ = self.model(x_wall_bottom, y_wall_bottom, t_wall_bottom)
        loss_wall = torch.mean(v_wall_t**2) &#43; torch.mean(v_wall_b**2)
        
        # 円柱表面境界条件(無滑り条件)
        u_cyl, v_cyl, _ = self.model(x_cylinder, y_cylinder, t_cylinder)
        loss_cylinder = torch.mean(u_cyl**2) &#43; torch.mean(v_cyl**2)
        
        # 初期条件
        u_init, v_init, _ = self.model(x_init, y_init, t_init)
        loss_init = torch.mean((u_init - 1.0)**2) &#43; torch.mean(v_init**2)
        
        # 総損失
        loss = loss_pde &#43; 10.0 * (loss_inlet &#43; loss_outlet &#43; loss_wall &#43; 
                                   loss_cylinder &#43; loss_init)
        
        return loss, loss_pde, loss_inlet, loss_outlet, loss_wall, loss_cylinder
    
    def train(self, epochs, x_domain, y_domain, t_domain,
              x_inlet, y_inlet, t_inlet,
              x_outlet, y_outlet, t_outlet,
              x_wall_top, y_wall_top, t_wall_top,
              x_wall_bottom, y_wall_bottom, t_wall_bottom,
              x_cylinder, y_cylinder, t_cylinder,
              x_init, y_init, t_init):
        &#34;&#34;&#34;モデルの訓練&#34;&#34;&#34;
        
        self.model.train()
        
        pbar = tqdm(range(epochs), desc=&#34;Training&#34;)
        for epoch in pbar:
            self.optimizer.zero_grad()
            
            loss, loss_pde, loss_inlet, loss_outlet, loss_wall, loss_cylinder = \
                self.loss_function(x_domain, y_domain, t_domain,
                                 x_inlet, y_inlet, t_inlet,
                                 x_outlet, y_outlet, t_outlet,
                                 x_wall_top, y_wall_top, t_wall_top,
                                 x_wall_bottom, y_wall_bottom, t_wall_bottom,
                                 x_cylinder, y_cylinder, t_cylinder,
                                 x_init, y_init, t_init)
            
            loss.backward()
            self.optimizer.step()
            self.scheduler.step()
            
            self.loss_history.append(loss.item())
            
            if epoch % 100 == 0:
                pbar.set_postfix({
                    &#39;Loss&#39;: f&#39;{loss.item():.4e}&#39;,
                    &#39;PDE&#39;: f&#39;{loss_pde.item():.4e}&#39;,
                    &#39;BC&#39;: f&#39;{(loss_inlet &#43; loss_outlet &#43; loss_wall &#43; loss_cylinder).item():.4e}&#39;
                })
        
    def predict(self, x, y, t):
        &#34;&#34;&#34;予測&#34;&#34;&#34;
        self.model.eval()
        with torch.no_grad():
            u, v, p = self.model(x, y, t)
        return u, v, p

# サンプリング点の生成
def generate_training_data(N_domain=5000, N_boundary=500, N_initial=1000):
    &#34;&#34;&#34;訓練データの生成&#34;&#34;&#34;
    
    # 計算領域の定義
    x_min, x_max = -2.0, 10.0
    y_min, y_max = -2.0, 2.0
    t_min, t_max = 0.0, 5.0
    
    # 円柱のパラメータ
    x_cyl, y_cyl = 0.0, 0.0
    r_cyl = 0.5
    
    # 領域内のランダムサンプリング(円柱内部を除く)
    x_domain = []
    y_domain = []
    t_domain = []
    
    while len(x_domain) &lt; N_domain:
        x = np.random.uniform(x_min, x_max, N_domain * 2)
        y = np.random.uniform(y_min, y_max, N_domain * 2)
        t = np.random.uniform(t_min, t_max, N_domain * 2)
        
        # 円柱内部を除外
        mask = (x - x_cyl)**2 &#43; (y - y_cyl)**2 &gt; r_cyl**2
        x = x[mask]
        y = y[mask]
        t = t[mask]
        
        x_domain.extend(x[:N_domain - len(x_domain)])
        y_domain.extend(y[:N_domain - len(y_domain)])
        t_domain.extend(t[:N_domain - len(t_domain)])
    
    x_domain = torch.FloatTensor(x_domain).reshape(-1, 1).to(device)
    y_domain = torch.FloatTensor(y_domain).reshape(-1, 1).to(device)
    t_domain = torch.FloatTensor(t_domain).reshape(-1, 1).to(device)
    
    # 入口境界(x = x_min)
    x_inlet = torch.ones(N_boundary, 1).to(device) * x_min
    y_inlet = torch.FloatTensor(np.random.uniform(y_min, y_max, N_boundary)).reshape(-1, 1).to(device)
    t_inlet = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device)
    
    # 出口境界(x = x_max)
    x_outlet = torch.ones(N_boundary, 1).to(device) * x_max
    y_outlet = torch.FloatTensor(np.random.uniform(y_min, y_max, N_boundary)).reshape(-1, 1).to(device)
    t_outlet = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device)
    
    # 上壁境界(y = y_max)
    x_wall_top = torch.FloatTensor(np.random.uniform(x_min, x_max, N_boundary)).reshape(-1, 1).to(device)
    y_wall_top = torch.ones(N_boundary, 1).to(device) * y_max
    t_wall_top = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device)
    
    # 下壁境界(y = y_min)
    x_wall_bottom = torch.FloatTensor(np.random.uniform(x_min, x_max, N_boundary)).reshape(-1, 1).to(device)
    y_wall_bottom = torch.ones(N_boundary, 1).to(device) * y_min
    t_wall_bottom = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device)
    
    # 円柱表面境界
    theta = np.random.uniform(0, 2*np.pi, N_boundary)
    x_cylinder = torch.FloatTensor(x_cyl &#43; r_cyl * np.cos(theta)).reshape(-1, 1).to(device)
    y_cylinder = torch.FloatTensor(y_cyl &#43; r_cyl * np.sin(theta)).reshape(-1, 1).to(device)
    t_cylinder = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device)
    
    # 初期条件(t = 0)
    x_init = []
    y_init = []
    
    while len(x_init) &lt; N_initial:
        x = np.random.uniform(x_min, x_max, N_initial * 2)
        y = np.random.uniform(y_min, y_max, N_initial * 2)
        
        mask = (x - x_cyl)**2 &#43; (y - y_cyl)**2 &gt; r_cyl**2
        x = x[mask]
        y = y[mask]
        
        x_init.extend(x[:N_initial - len(x_init)])
        y_init.extend(y[:N_initial - len(y_init)])
    
    x_init = torch.FloatTensor(x_init).reshape(-1, 1).to(device)
    y_init = torch.FloatTensor(y_init).reshape(-1, 1).to(device)
    t_init = torch.zeros(N_initial, 1).to(device)
    
    return (x_domain, y_domain, t_domain,
            x_inlet, y_inlet, t_inlet,
            x_outlet, y_outlet, t_outlet,
            x_wall_top, y_wall_top, t_wall_top,
            x_wall_bottom, y_wall_bottom, t_wall_bottom,
            x_cylinder, y_cylinder, t_cylinder,
            x_init, y_init, t_init)

# 可視化
def visualize_flow(pinn, t_value=2.0, save_path=&#39;flow_field.png&#39;):
    &#34;&#34;&#34;流れ場の可視化&#34;&#34;&#34;
    
    x = np.linspace(-2, 10, 150)
    y = np.linspace(-2, 2, 80)
    X, Y = np.meshgrid(x, y)
    
    x_flat = torch.FloatTensor(X.flatten()).reshape(-1, 1).to(device)
    y_flat = torch.FloatTensor(Y.flatten()).reshape(-1, 1).to(device)
    t_flat = torch.ones_like(x_flat) * t_value
    
    u, v, p = pinn.predict(x_flat, y_flat, t_flat)
    
    u = u.cpu().numpy().reshape(X.shape)
    v = v.cpu().numpy().reshape(X.shape)
    p = p.cpu().numpy().reshape(X.shape)
    
    # 円柱内部をマスク
    mask = (X - 0.0)**2 &#43; (Y - 0.0)**2 &lt; 0.5**2
    u[mask] = np.nan
    v[mask] = np.nan
    p[mask] = np.nan
    
    # 速度の大きさ
    velocity_magnitude = np.sqrt(u**2 &#43; v**2)
    
    fig, axes = plt.subplots(2, 2, figsize=(16, 8))
    
    # u速度
    im1 = axes[0, 0].contourf(X, Y, u, levels=20, cmap=&#39;RdBu_r&#39;)
    axes[0, 0].set_title(f&#39;u-velocity at t={t_value}&#39;)
    axes[0, 0].set_xlabel(&#39;x&#39;)
    axes[0, 0].set_ylabel(&#39;y&#39;)
    axes[0, 0].add_patch(plt.Circle((0, 0), 0.5, color=&#39;black&#39;))
    plt.colorbar(im1, ax=axes[0, 0])
    
    # v速度
    im2 = axes[0, 1].contourf(X, Y, v, levels=20, cmap=&#39;RdBu_r&#39;)
    axes[0, 1].set_title(f&#39;v-velocity at t={t_value}&#39;)
    axes[0, 1].set_xlabel(&#39;x&#39;)
    axes[0, 1].set_ylabel(&#39;y&#39;)
    axes[0, 1].add_patch(plt.Circle((0, 0), 0.5, color=&#39;black&#39;))
    plt.colorbar(im2, ax=axes[0, 1])
    
    # 圧力
    im3 = axes[1, 0].contourf(X, Y, p, levels=20, cmap=&#39;RdBu_r&#39;)
    axes[1, 0].set_title(f&#39;Pressure at t={t_value}&#39;)
    axes[1, 0].set_xlabel(&#39;x&#39;)
    axes[1, 0].set_ylabel(&#39;y&#39;)
    axes[1, 0].add_patch(plt.Circle((0, 0), 0.5, color=&#39;black&#39;))
    plt.colorbar(im3, ax=axes[1, 0])
    
    # 速度の大きさとストリームライン
    im4 = axes[1, 1].contourf(X, Y, velocity_magnitude, levels=20, cmap=&#39;viridis&#39;)
    axes[1, 1].streamplot(X, Y, u, v, color=&#39;white&#39;, linewidth=0.5, density=1.5)
    axes[1, 1].set_title(f&#39;Velocity magnitude at t={t_value}&#39;)
    axes[1, 1].set_xlabel(&#39;x&#39;)
    axes[1, 1].set_ylabel(&#39;y&#39;)
    axes[1, 1].add_patch(plt.Circle((0, 0), 0.5, color=&#39;black&#39;))
    plt.colorbar(im4, ax=axes[1, 1])
    
    plt.tight_layout()
    plt.savefig(save_path, dpi=150, bbox_inches=&#39;tight&#39;)
    plt.show()
    
    print(f&#34;Flow field visualization saved to {save_path}&#34;)

def plot_loss_history(pinn, save_path=&#39;loss_history.png&#39;):
    &#34;&#34;&#34;損失関数の履歴をプロット&#34;&#34;&#34;
    
    plt.figure(figsize=(10, 6))
    plt.plot(pinn.loss_history)
    plt.yscale(&#39;log&#39;)
    plt.xlabel(&#39;Iteration&#39;)
    plt.ylabel(&#39;Loss&#39;)
    plt.title(&#39;Training Loss History&#39;)
    plt.grid(True)
    plt.savefig(save_path, dpi=150, bbox_inches=&#39;tight&#39;)
    plt.show()
    
    print(f&#34;Loss history plot saved to {save_path}&#34;)

# メイン実行
if __name__ == &#34;__main__&#34;:
    # ハイパーパラメータ
    layers = [3, 64, 64, 64, 64, 3]  # [入力層, 隠れ層..., 出力層]
    Re = 100  # レイノルズ数
    epochs = 10000  # 訓練エポック数
    
    print(&#34;=&#34; * 60)
    print(&#34;2D Cylinder Flow Simulation using PINN&#34;)
    print(&#34;=&#34; * 60)
    print(f&#34;Reynolds number: {Re}&#34;)
    print(f&#34;Network architecture: {layers}&#34;)
    print(f&#34;Training epochs: {epochs}&#34;)
    print(&#34;=&#34; * 60)
    
    # PINNモデルの初期化
    pinn = NavierStokesPINN(layers, Re=Re)
    
    # 訓練データの生成
    print(&#34;\nGenerating training data...&#34;)
    training_data = generate_training_data(
        N_domain=5000,
        N_boundary=500,
        N_initial=1000
    )
    
    # モデルの訓練
    print(&#34;\nStarting training...&#34;)
    pinn.train(epochs, *training_data)
    
    # 損失関数の履歴をプロット
    print(&#34;\nPlotting loss history...&#34;)
    plot_loss_history(pinn, save_path=&#39;/workspace/outputs/loss_history.png&#39;)
    
    # 流れ場の可視化(複数の時刻)
    print(&#34;\nVisualizing flow fields...&#34;)
    for t in [0.5, 1.0, 2.0, 3.0]:
        visualize_flow(pinn, t_value=t, 
                      save_path=f&#39;/workspace/outputs/flow_field_t{t:.1f}.png&#39;)
    
    # モデルの保存
    torch.save(pinn.model.state_dict(), &#39;/workspace/outputs/pinn_cylinder_model.pth&#39;)
    print(&#34;\nModel saved to /workspace/outputs/pinn_cylinder_model.pth&#34;)
    
    print(&#34;\n&#34; &#43; &#34;=&#34; * 60)
    print(&#34;Simulation completed!&#34;)
    print(&#34;=&#34; * 60)
Execution results
Error History
"><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "akenji\u0027s lab",
    
    "url": "https:\/\/akenji3.github.io\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/akenji3.github.io\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/akenji3.github.io\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/akenji3.github.io\/en\/post\/20260103_pinn-claude\/",
          "name": "Imulation of a two dimensional cylinder wake by claude"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "imulation of a Two-Dimensional Cylinder Wake by Claude",
  "description" : "Introduction Around this time last year, I spent two months working on a simulation of a two-dimensional cylindrical wake using PINNs. I hadn\u0026rsquo;t finished working on this article. This time, since I built a new Python development environment, I decided to tackle this theme as an example project, with Claude as my companion.\nCode Generation Prompt I had Claude generate the source code using the following prompt.\nPlease generate PyTorch-based code to simulate the wake flow behind a two-dimensional cylinder using PINN. Generated code import torch import torch.nn as nn import numpy as np import matplotlib.pyplot as plt from matplotlib.animation import FuncAnimation from tqdm import tqdm # デバイスの設定 device = torch.device(\u0026#39;cuda\u0026#39; if torch.cuda.is_available() else \u0026#39;cpu\u0026#39;) print(f\u0026#34;Using device: {device}\u0026#34;) # ニューラルネットワークの定義 class PINN(nn.Module): def __init__(self, layers): super(PINN, self).__init__() self.layers = nn.ModuleList() for i in range(len(layers) - 1): self.layers.append(nn.Linear(layers[i], layers[i\u002b1])) def forward(self, x, y, t): # 入力の正規化 inputs = torch.cat([x, y, t], dim=1) for i in range(len(self.layers) - 1): inputs = torch.tanh(self.layers[i](inputs)) # 最終層(活性化関数なし) output = self.layers[-1](inputs) # 速度と圧力を出力 u = output[:, 0:1] # x方向速度 v = output[:, 1:2] # y方向速度 p = output[:, 2:3] # 圧力 return u, v, p # Navier-Stokes方程式の残差計算 class NavierStokesPINN: def __init__(self, layers, Re=100): self.model = PINN(layers).to(device) self.Re = Re # レイノルズ数 self.nu = 1.0 \/ Re # 動粘性係数 # 最適化アルゴリズム self.optimizer = torch.optim.Adam(self.model.parameters(), lr=1e-3) self.scheduler = torch.optim.lr_scheduler.StepLR( self.optimizer, step_size=5000, gamma=0.9 ) self.loss_history = [] def net_NS(self, x, y, t): \u0026#34;\u0026#34;\u0026#34;Navier-Stokes方程式の残差を計算\u0026#34;\u0026#34;\u0026#34; x.requires_grad_(True) y.requires_grad_(True) t.requires_grad_(True) u, v, p = self.model(x, y, t) # 1階微分 u_x = torch.autograd.grad(u, x, grad_outputs=torch.ones_like(u), create_graph=True)[0] u_y = torch.autograd.grad(u, y, grad_outputs=torch.ones_like(u), create_graph=True)[0] u_t = torch.autograd.grad(u, t, grad_outputs=torch.ones_like(u), create_graph=True)[0] v_x = torch.autograd.grad(v, x, grad_outputs=torch.ones_like(v), create_graph=True)[0] v_y = torch.autograd.grad(v, y, grad_outputs=torch.ones_like(v), create_graph=True)[0] v_t = torch.autograd.grad(v, t, grad_outputs=torch.ones_like(v), create_graph=True)[0] p_x = torch.autograd.grad(p, x, grad_outputs=torch.ones_like(p), create_graph=True)[0] p_y = torch.autograd.grad(p, y, grad_outputs=torch.ones_like(p), create_graph=True)[0] # 2階微分 u_xx = torch.autograd.grad(u_x, x, grad_outputs=torch.ones_like(u_x), create_graph=True)[0] u_yy = torch.autograd.grad(u_y, y, grad_outputs=torch.ones_like(u_y), create_graph=True)[0] v_xx = torch.autograd.grad(v_x, x, grad_outputs=torch.ones_like(v_x), create_graph=True)[0] v_yy = torch.autograd.grad(v_y, y, grad_outputs=torch.ones_like(v_y), create_graph=True)[0] # Navier-Stokes方程式(運動量保存則) f_u = u_t \u002b u * u_x \u002b v * u_y \u002b p_x - self.nu * (u_xx \u002b u_yy) f_v = v_t \u002b u * v_x \u002b v * v_y \u002b p_y - self.nu * (v_xx \u002b v_yy) # 連続の式(質量保存則) f_cont = u_x \u002b v_y return f_u, f_v, f_cont, u, v, p def loss_function(self, x_domain, y_domain, t_domain, x_inlet, y_inlet, t_inlet, x_outlet, y_outlet, t_outlet, x_wall_top, y_wall_top, t_wall_top, x_wall_bottom, y_wall_bottom, t_wall_bottom, x_cylinder, y_cylinder, t_cylinder, x_init, y_init, t_init): \u0026#34;\u0026#34;\u0026#34;損失関数の計算\u0026#34;\u0026#34;\u0026#34; # 領域内でのNavier-Stokes方程式の残差 f_u, f_v, f_cont, _, _, _ = self.net_NS(x_domain, y_domain, t_domain) loss_pde = torch.mean(f_u**2) \u002b torch.mean(f_v**2) \u002b torch.mean(f_cont**2) # 入口境界条件(一様流) u_inlet, v_inlet, _ = self.model(x_inlet, y_inlet, t_inlet) loss_inlet = torch.mean((u_inlet - 1.0)**2) \u002b torch.mean(v_inlet**2) # 出口境界条件(圧力ゼロ、速度の勾配ゼロに近似) u_outlet, v_outlet, p_outlet = self.model(x_outlet, y_outlet, t_outlet) loss_outlet = torch.mean(p_outlet**2) # 上下壁境界条件(自由滑り) u_wall_t, v_wall_t, _ = self.model(x_wall_top, y_wall_top, t_wall_top) u_wall_b, v_wall_b, _ = self.model(x_wall_bottom, y_wall_bottom, t_wall_bottom) loss_wall = torch.mean(v_wall_t**2) \u002b torch.mean(v_wall_b**2) # 円柱表面境界条件(無滑り条件) u_cyl, v_cyl, _ = self.model(x_cylinder, y_cylinder, t_cylinder) loss_cylinder = torch.mean(u_cyl**2) \u002b torch.mean(v_cyl**2) # 初期条件 u_init, v_init, _ = self.model(x_init, y_init, t_init) loss_init = torch.mean((u_init - 1.0)**2) \u002b torch.mean(v_init**2) # 総損失 loss = loss_pde \u002b 10.0 * (loss_inlet \u002b loss_outlet \u002b loss_wall \u002b loss_cylinder \u002b loss_init) return loss, loss_pde, loss_inlet, loss_outlet, loss_wall, loss_cylinder def train(self, epochs, x_domain, y_domain, t_domain, x_inlet, y_inlet, t_inlet, x_outlet, y_outlet, t_outlet, x_wall_top, y_wall_top, t_wall_top, x_wall_bottom, y_wall_bottom, t_wall_bottom, x_cylinder, y_cylinder, t_cylinder, x_init, y_init, t_init): \u0026#34;\u0026#34;\u0026#34;モデルの訓練\u0026#34;\u0026#34;\u0026#34; self.model.train() pbar = tqdm(range(epochs), desc=\u0026#34;Training\u0026#34;) for epoch in pbar: self.optimizer.zero_grad() loss, loss_pde, loss_inlet, loss_outlet, loss_wall, loss_cylinder = \\ self.loss_function(x_domain, y_domain, t_domain, x_inlet, y_inlet, t_inlet, x_outlet, y_outlet, t_outlet, x_wall_top, y_wall_top, t_wall_top, x_wall_bottom, y_wall_bottom, t_wall_bottom, x_cylinder, y_cylinder, t_cylinder, x_init, y_init, t_init) loss.backward() self.optimizer.step() self.scheduler.step() self.loss_history.append(loss.item()) if epoch % 100 == 0: pbar.set_postfix({ \u0026#39;Loss\u0026#39;: f\u0026#39;{loss.item():.4e}\u0026#39;, \u0026#39;PDE\u0026#39;: f\u0026#39;{loss_pde.item():.4e}\u0026#39;, \u0026#39;BC\u0026#39;: f\u0026#39;{(loss_inlet \u002b loss_outlet \u002b loss_wall \u002b loss_cylinder).item():.4e}\u0026#39; }) def predict(self, x, y, t): \u0026#34;\u0026#34;\u0026#34;予測\u0026#34;\u0026#34;\u0026#34; self.model.eval() with torch.no_grad(): u, v, p = self.model(x, y, t) return u, v, p # サンプリング点の生成 def generate_training_data(N_domain=5000, N_boundary=500, N_initial=1000): \u0026#34;\u0026#34;\u0026#34;訓練データの生成\u0026#34;\u0026#34;\u0026#34; # 計算領域の定義 x_min, x_max = -2.0, 10.0 y_min, y_max = -2.0, 2.0 t_min, t_max = 0.0, 5.0 # 円柱のパラメータ x_cyl, y_cyl = 0.0, 0.0 r_cyl = 0.5 # 領域内のランダムサンプリング(円柱内部を除く) x_domain = [] y_domain = [] t_domain = [] while len(x_domain) \u0026lt; N_domain: x = np.random.uniform(x_min, x_max, N_domain * 2) y = np.random.uniform(y_min, y_max, N_domain * 2) t = np.random.uniform(t_min, t_max, N_domain * 2) # 円柱内部を除外 mask = (x - x_cyl)**2 \u002b (y - y_cyl)**2 \u0026gt; r_cyl**2 x = x[mask] y = y[mask] t = t[mask] x_domain.extend(x[:N_domain - len(x_domain)]) y_domain.extend(y[:N_domain - len(y_domain)]) t_domain.extend(t[:N_domain - len(t_domain)]) x_domain = torch.FloatTensor(x_domain).reshape(-1, 1).to(device) y_domain = torch.FloatTensor(y_domain).reshape(-1, 1).to(device) t_domain = torch.FloatTensor(t_domain).reshape(-1, 1).to(device) # 入口境界(x = x_min) x_inlet = torch.ones(N_boundary, 1).to(device) * x_min y_inlet = torch.FloatTensor(np.random.uniform(y_min, y_max, N_boundary)).reshape(-1, 1).to(device) t_inlet = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device) # 出口境界(x = x_max) x_outlet = torch.ones(N_boundary, 1).to(device) * x_max y_outlet = torch.FloatTensor(np.random.uniform(y_min, y_max, N_boundary)).reshape(-1, 1).to(device) t_outlet = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device) # 上壁境界(y = y_max) x_wall_top = torch.FloatTensor(np.random.uniform(x_min, x_max, N_boundary)).reshape(-1, 1).to(device) y_wall_top = torch.ones(N_boundary, 1).to(device) * y_max t_wall_top = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device) # 下壁境界(y = y_min) x_wall_bottom = torch.FloatTensor(np.random.uniform(x_min, x_max, N_boundary)).reshape(-1, 1).to(device) y_wall_bottom = torch.ones(N_boundary, 1).to(device) * y_min t_wall_bottom = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device) # 円柱表面境界 theta = np.random.uniform(0, 2*np.pi, N_boundary) x_cylinder = torch.FloatTensor(x_cyl \u002b r_cyl * np.cos(theta)).reshape(-1, 1).to(device) y_cylinder = torch.FloatTensor(y_cyl \u002b r_cyl * np.sin(theta)).reshape(-1, 1).to(device) t_cylinder = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device) # 初期条件(t = 0) x_init = [] y_init = [] while len(x_init) \u0026lt; N_initial: x = np.random.uniform(x_min, x_max, N_initial * 2) y = np.random.uniform(y_min, y_max, N_initial * 2) mask = (x - x_cyl)**2 \u002b (y - y_cyl)**2 \u0026gt; r_cyl**2 x = x[mask] y = y[mask] x_init.extend(x[:N_initial - len(x_init)]) y_init.extend(y[:N_initial - len(y_init)]) x_init = torch.FloatTensor(x_init).reshape(-1, 1).to(device) y_init = torch.FloatTensor(y_init).reshape(-1, 1).to(device) t_init = torch.zeros(N_initial, 1).to(device) return (x_domain, y_domain, t_domain, x_inlet, y_inlet, t_inlet, x_outlet, y_outlet, t_outlet, x_wall_top, y_wall_top, t_wall_top, x_wall_bottom, y_wall_bottom, t_wall_bottom, x_cylinder, y_cylinder, t_cylinder, x_init, y_init, t_init) # 可視化 def visualize_flow(pinn, t_value=2.0, save_path=\u0026#39;flow_field.png\u0026#39;): \u0026#34;\u0026#34;\u0026#34;流れ場の可視化\u0026#34;\u0026#34;\u0026#34; x = np.linspace(-2, 10, 150) y = np.linspace(-2, 2, 80) X, Y = np.meshgrid(x, y) x_flat = torch.FloatTensor(X.flatten()).reshape(-1, 1).to(device) y_flat = torch.FloatTensor(Y.flatten()).reshape(-1, 1).to(device) t_flat = torch.ones_like(x_flat) * t_value u, v, p = pinn.predict(x_flat, y_flat, t_flat) u = u.cpu().numpy().reshape(X.shape) v = v.cpu().numpy().reshape(X.shape) p = p.cpu().numpy().reshape(X.shape) # 円柱内部をマスク mask = (X - 0.0)**2 \u002b (Y - 0.0)**2 \u0026lt; 0.5**2 u[mask] = np.nan v[mask] = np.nan p[mask] = np.nan # 速度の大きさ velocity_magnitude = np.sqrt(u**2 \u002b v**2) fig, axes = plt.subplots(2, 2, figsize=(16, 8)) # u速度 im1 = axes[0, 0].contourf(X, Y, u, levels=20, cmap=\u0026#39;RdBu_r\u0026#39;) axes[0, 0].set_title(f\u0026#39;u-velocity at t={t_value}\u0026#39;) axes[0, 0].set_xlabel(\u0026#39;x\u0026#39;) axes[0, 0].set_ylabel(\u0026#39;y\u0026#39;) axes[0, 0].add_patch(plt.Circle((0, 0), 0.5, color=\u0026#39;black\u0026#39;)) plt.colorbar(im1, ax=axes[0, 0]) # v速度 im2 = axes[0, 1].contourf(X, Y, v, levels=20, cmap=\u0026#39;RdBu_r\u0026#39;) axes[0, 1].set_title(f\u0026#39;v-velocity at t={t_value}\u0026#39;) axes[0, 1].set_xlabel(\u0026#39;x\u0026#39;) axes[0, 1].set_ylabel(\u0026#39;y\u0026#39;) axes[0, 1].add_patch(plt.Circle((0, 0), 0.5, color=\u0026#39;black\u0026#39;)) plt.colorbar(im2, ax=axes[0, 1]) # 圧力 im3 = axes[1, 0].contourf(X, Y, p, levels=20, cmap=\u0026#39;RdBu_r\u0026#39;) axes[1, 0].set_title(f\u0026#39;Pressure at t={t_value}\u0026#39;) axes[1, 0].set_xlabel(\u0026#39;x\u0026#39;) axes[1, 0].set_ylabel(\u0026#39;y\u0026#39;) axes[1, 0].add_patch(plt.Circle((0, 0), 0.5, color=\u0026#39;black\u0026#39;)) plt.colorbar(im3, ax=axes[1, 0]) # 速度の大きさとストリームライン im4 = axes[1, 1].contourf(X, Y, velocity_magnitude, levels=20, cmap=\u0026#39;viridis\u0026#39;) axes[1, 1].streamplot(X, Y, u, v, color=\u0026#39;white\u0026#39;, linewidth=0.5, density=1.5) axes[1, 1].set_title(f\u0026#39;Velocity magnitude at t={t_value}\u0026#39;) axes[1, 1].set_xlabel(\u0026#39;x\u0026#39;) axes[1, 1].set_ylabel(\u0026#39;y\u0026#39;) axes[1, 1].add_patch(plt.Circle((0, 0), 0.5, color=\u0026#39;black\u0026#39;)) plt.colorbar(im4, ax=axes[1, 1]) plt.tight_layout() plt.savefig(save_path, dpi=150, bbox_inches=\u0026#39;tight\u0026#39;) plt.show() print(f\u0026#34;Flow field visualization saved to {save_path}\u0026#34;) def plot_loss_history(pinn, save_path=\u0026#39;loss_history.png\u0026#39;): \u0026#34;\u0026#34;\u0026#34;損失関数の履歴をプロット\u0026#34;\u0026#34;\u0026#34; plt.figure(figsize=(10, 6)) plt.plot(pinn.loss_history) plt.yscale(\u0026#39;log\u0026#39;) plt.xlabel(\u0026#39;Iteration\u0026#39;) plt.ylabel(\u0026#39;Loss\u0026#39;) plt.title(\u0026#39;Training Loss History\u0026#39;) plt.grid(True) plt.savefig(save_path, dpi=150, bbox_inches=\u0026#39;tight\u0026#39;) plt.show() print(f\u0026#34;Loss history plot saved to {save_path}\u0026#34;) # メイン実行 if __name__ == \u0026#34;__main__\u0026#34;: # ハイパーパラメータ layers = [3, 64, 64, 64, 64, 3] # [入力層, 隠れ層..., 出力層] Re = 100 # レイノルズ数 epochs = 10000 # 訓練エポック数 print(\u0026#34;=\u0026#34; * 60) print(\u0026#34;2D Cylinder Flow Simulation using PINN\u0026#34;) print(\u0026#34;=\u0026#34; * 60) print(f\u0026#34;Reynolds number: {Re}\u0026#34;) print(f\u0026#34;Network architecture: {layers}\u0026#34;) print(f\u0026#34;Training epochs: {epochs}\u0026#34;) print(\u0026#34;=\u0026#34; * 60) # PINNモデルの初期化 pinn = NavierStokesPINN(layers, Re=Re) # 訓練データの生成 print(\u0026#34;\\nGenerating training data...\u0026#34;) training_data = generate_training_data( N_domain=5000, N_boundary=500, N_initial=1000 ) # モデルの訓練 print(\u0026#34;\\nStarting training...\u0026#34;) pinn.train(epochs, *training_data) # 損失関数の履歴をプロット print(\u0026#34;\\nPlotting loss history...\u0026#34;) plot_loss_history(pinn, save_path=\u0026#39;\/workspace\/outputs\/loss_history.png\u0026#39;) # 流れ場の可視化(複数の時刻) print(\u0026#34;\\nVisualizing flow fields...\u0026#34;) for t in [0.5, 1.0, 2.0, 3.0]: visualize_flow(pinn, t_value=t, save_path=f\u0026#39;\/workspace\/outputs\/flow_field_t{t:.1f}.png\u0026#39;) # モデルの保存 torch.save(pinn.model.state_dict(), \u0026#39;\/workspace\/outputs\/pinn_cylinder_model.pth\u0026#39;) print(\u0026#34;\\nModel saved to \/workspace\/outputs\/pinn_cylinder_model.pth\u0026#34;) print(\u0026#34;\\n\u0026#34; \u002b \u0026#34;=\u0026#34; * 60) print(\u0026#34;Simulation completed!\u0026#34;) print(\u0026#34;=\u0026#34; * 60) Execution results Error History ",
  "inLanguage" : "en",
  "wordCount":  2016 ,
  "datePublished" : "2026-01-03T00:00:00\u002b00:00",
  "dateModified" : "2026-01-03T00:00:00\u002b00:00",
  "image" : "https:\/\/akenji3.github.io\/img\/avatar-icon.png",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/akenji3.github.io\/en\/post\/20260103_pinn-claude\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/akenji3.github.io\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/akenji3.github.io\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="imulation of a Two-Dimensional Cylinder Wake by Claude" />
<meta property="og:description" content="Introduction
Around this time last year, I spent two months working on a simulation of a two-dimensional cylindrical wake using PINNs. I hadn&rsquo;t finished working on this article.
This time, since I built a new Python development environment, I decided to tackle this theme as an example project, with Claude as my companion.
Code Generation
Prompt
I had Claude generate the source code using the following prompt.
Please generate PyTorch-based code to simulate the wake flow behind a two-dimensional cylinder using PINN.
Generated code
import torch
import torch.nn as nn
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.animation import FuncAnimation
from tqdm import tqdm

# デバイスの設定
device = torch.device(&#39;cuda&#39; if torch.cuda.is_available() else &#39;cpu&#39;)
print(f&#34;Using device: {device}&#34;)

# ニューラルネットワークの定義
class PINN(nn.Module):
    def __init__(self, layers):
        super(PINN, self).__init__()
        self.layers = nn.ModuleList()
        
        for i in range(len(layers) - 1):
            self.layers.append(nn.Linear(layers[i], layers[i&#43;1]))
            
    def forward(self, x, y, t):
        # 入力の正規化
        inputs = torch.cat([x, y, t], dim=1)
        
        for i in range(len(self.layers) - 1):
            inputs = torch.tanh(self.layers[i](inputs))
        
        # 最終層(活性化関数なし)
        output = self.layers[-1](inputs)
        
        # 速度と圧力を出力
        u = output[:, 0:1]  # x方向速度
        v = output[:, 1:2]  # y方向速度
        p = output[:, 2:3]  # 圧力
        
        return u, v, p

# Navier-Stokes方程式の残差計算
class NavierStokesPINN:
    def __init__(self, layers, Re=100):
        self.model = PINN(layers).to(device)
        self.Re = Re  # レイノルズ数
        self.nu = 1.0 / Re  # 動粘性係数
        
        # 最適化アルゴリズム
        self.optimizer = torch.optim.Adam(self.model.parameters(), lr=1e-3)
        self.scheduler = torch.optim.lr_scheduler.StepLR(
            self.optimizer, step_size=5000, gamma=0.9
        )
        
        self.loss_history = []
        
    def net_NS(self, x, y, t):
        &#34;&#34;&#34;Navier-Stokes方程式の残差を計算&#34;&#34;&#34;
        x.requires_grad_(True)
        y.requires_grad_(True)
        t.requires_grad_(True)
        
        u, v, p = self.model(x, y, t)
        
        # 1階微分
        u_x = torch.autograd.grad(u, x, grad_outputs=torch.ones_like(u), 
                                   create_graph=True)[0]
        u_y = torch.autograd.grad(u, y, grad_outputs=torch.ones_like(u), 
                                   create_graph=True)[0]
        u_t = torch.autograd.grad(u, t, grad_outputs=torch.ones_like(u), 
                                   create_graph=True)[0]
        
        v_x = torch.autograd.grad(v, x, grad_outputs=torch.ones_like(v), 
                                   create_graph=True)[0]
        v_y = torch.autograd.grad(v, y, grad_outputs=torch.ones_like(v), 
                                   create_graph=True)[0]
        v_t = torch.autograd.grad(v, t, grad_outputs=torch.ones_like(v), 
                                   create_graph=True)[0]
        
        p_x = torch.autograd.grad(p, x, grad_outputs=torch.ones_like(p), 
                                   create_graph=True)[0]
        p_y = torch.autograd.grad(p, y, grad_outputs=torch.ones_like(p), 
                                   create_graph=True)[0]
        
        # 2階微分
        u_xx = torch.autograd.grad(u_x, x, grad_outputs=torch.ones_like(u_x), 
                                    create_graph=True)[0]
        u_yy = torch.autograd.grad(u_y, y, grad_outputs=torch.ones_like(u_y), 
                                    create_graph=True)[0]
        
        v_xx = torch.autograd.grad(v_x, x, grad_outputs=torch.ones_like(v_x), 
                                    create_graph=True)[0]
        v_yy = torch.autograd.grad(v_y, y, grad_outputs=torch.ones_like(v_y), 
                                    create_graph=True)[0]
        
        # Navier-Stokes方程式(運動量保存則)
        f_u = u_t &#43; u * u_x &#43; v * u_y &#43; p_x - self.nu * (u_xx &#43; u_yy)
        f_v = v_t &#43; u * v_x &#43; v * v_y &#43; p_y - self.nu * (v_xx &#43; v_yy)
        
        # 連続の式(質量保存則)
        f_cont = u_x &#43; v_y
        
        return f_u, f_v, f_cont, u, v, p
    
    def loss_function(self, x_domain, y_domain, t_domain,
                     x_inlet, y_inlet, t_inlet,
                     x_outlet, y_outlet, t_outlet,
                     x_wall_top, y_wall_top, t_wall_top,
                     x_wall_bottom, y_wall_bottom, t_wall_bottom,
                     x_cylinder, y_cylinder, t_cylinder,
                     x_init, y_init, t_init):
        &#34;&#34;&#34;損失関数の計算&#34;&#34;&#34;
        
        # 領域内でのNavier-Stokes方程式の残差
        f_u, f_v, f_cont, _, _, _ = self.net_NS(x_domain, y_domain, t_domain)
        loss_pde = torch.mean(f_u**2) &#43; torch.mean(f_v**2) &#43; torch.mean(f_cont**2)
        
        # 入口境界条件(一様流)
        u_inlet, v_inlet, _ = self.model(x_inlet, y_inlet, t_inlet)
        loss_inlet = torch.mean((u_inlet - 1.0)**2) &#43; torch.mean(v_inlet**2)
        
        # 出口境界条件(圧力ゼロ、速度の勾配ゼロに近似)
        u_outlet, v_outlet, p_outlet = self.model(x_outlet, y_outlet, t_outlet)
        loss_outlet = torch.mean(p_outlet**2)
        
        # 上下壁境界条件(自由滑り)
        u_wall_t, v_wall_t, _ = self.model(x_wall_top, y_wall_top, t_wall_top)
        u_wall_b, v_wall_b, _ = self.model(x_wall_bottom, y_wall_bottom, t_wall_bottom)
        loss_wall = torch.mean(v_wall_t**2) &#43; torch.mean(v_wall_b**2)
        
        # 円柱表面境界条件(無滑り条件)
        u_cyl, v_cyl, _ = self.model(x_cylinder, y_cylinder, t_cylinder)
        loss_cylinder = torch.mean(u_cyl**2) &#43; torch.mean(v_cyl**2)
        
        # 初期条件
        u_init, v_init, _ = self.model(x_init, y_init, t_init)
        loss_init = torch.mean((u_init - 1.0)**2) &#43; torch.mean(v_init**2)
        
        # 総損失
        loss = loss_pde &#43; 10.0 * (loss_inlet &#43; loss_outlet &#43; loss_wall &#43; 
                                   loss_cylinder &#43; loss_init)
        
        return loss, loss_pde, loss_inlet, loss_outlet, loss_wall, loss_cylinder
    
    def train(self, epochs, x_domain, y_domain, t_domain,
              x_inlet, y_inlet, t_inlet,
              x_outlet, y_outlet, t_outlet,
              x_wall_top, y_wall_top, t_wall_top,
              x_wall_bottom, y_wall_bottom, t_wall_bottom,
              x_cylinder, y_cylinder, t_cylinder,
              x_init, y_init, t_init):
        &#34;&#34;&#34;モデルの訓練&#34;&#34;&#34;
        
        self.model.train()
        
        pbar = tqdm(range(epochs), desc=&#34;Training&#34;)
        for epoch in pbar:
            self.optimizer.zero_grad()
            
            loss, loss_pde, loss_inlet, loss_outlet, loss_wall, loss_cylinder = \
                self.loss_function(x_domain, y_domain, t_domain,
                                 x_inlet, y_inlet, t_inlet,
                                 x_outlet, y_outlet, t_outlet,
                                 x_wall_top, y_wall_top, t_wall_top,
                                 x_wall_bottom, y_wall_bottom, t_wall_bottom,
                                 x_cylinder, y_cylinder, t_cylinder,
                                 x_init, y_init, t_init)
            
            loss.backward()
            self.optimizer.step()
            self.scheduler.step()
            
            self.loss_history.append(loss.item())
            
            if epoch % 100 == 0:
                pbar.set_postfix({
                    &#39;Loss&#39;: f&#39;{loss.item():.4e}&#39;,
                    &#39;PDE&#39;: f&#39;{loss_pde.item():.4e}&#39;,
                    &#39;BC&#39;: f&#39;{(loss_inlet &#43; loss_outlet &#43; loss_wall &#43; loss_cylinder).item():.4e}&#39;
                })
        
    def predict(self, x, y, t):
        &#34;&#34;&#34;予測&#34;&#34;&#34;
        self.model.eval()
        with torch.no_grad():
            u, v, p = self.model(x, y, t)
        return u, v, p

# サンプリング点の生成
def generate_training_data(N_domain=5000, N_boundary=500, N_initial=1000):
    &#34;&#34;&#34;訓練データの生成&#34;&#34;&#34;
    
    # 計算領域の定義
    x_min, x_max = -2.0, 10.0
    y_min, y_max = -2.0, 2.0
    t_min, t_max = 0.0, 5.0
    
    # 円柱のパラメータ
    x_cyl, y_cyl = 0.0, 0.0
    r_cyl = 0.5
    
    # 領域内のランダムサンプリング(円柱内部を除く)
    x_domain = []
    y_domain = []
    t_domain = []
    
    while len(x_domain) &lt; N_domain:
        x = np.random.uniform(x_min, x_max, N_domain * 2)
        y = np.random.uniform(y_min, y_max, N_domain * 2)
        t = np.random.uniform(t_min, t_max, N_domain * 2)
        
        # 円柱内部を除外
        mask = (x - x_cyl)**2 &#43; (y - y_cyl)**2 &gt; r_cyl**2
        x = x[mask]
        y = y[mask]
        t = t[mask]
        
        x_domain.extend(x[:N_domain - len(x_domain)])
        y_domain.extend(y[:N_domain - len(y_domain)])
        t_domain.extend(t[:N_domain - len(t_domain)])
    
    x_domain = torch.FloatTensor(x_domain).reshape(-1, 1).to(device)
    y_domain = torch.FloatTensor(y_domain).reshape(-1, 1).to(device)
    t_domain = torch.FloatTensor(t_domain).reshape(-1, 1).to(device)
    
    # 入口境界(x = x_min)
    x_inlet = torch.ones(N_boundary, 1).to(device) * x_min
    y_inlet = torch.FloatTensor(np.random.uniform(y_min, y_max, N_boundary)).reshape(-1, 1).to(device)
    t_inlet = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device)
    
    # 出口境界(x = x_max)
    x_outlet = torch.ones(N_boundary, 1).to(device) * x_max
    y_outlet = torch.FloatTensor(np.random.uniform(y_min, y_max, N_boundary)).reshape(-1, 1).to(device)
    t_outlet = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device)
    
    # 上壁境界(y = y_max)
    x_wall_top = torch.FloatTensor(np.random.uniform(x_min, x_max, N_boundary)).reshape(-1, 1).to(device)
    y_wall_top = torch.ones(N_boundary, 1).to(device) * y_max
    t_wall_top = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device)
    
    # 下壁境界(y = y_min)
    x_wall_bottom = torch.FloatTensor(np.random.uniform(x_min, x_max, N_boundary)).reshape(-1, 1).to(device)
    y_wall_bottom = torch.ones(N_boundary, 1).to(device) * y_min
    t_wall_bottom = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device)
    
    # 円柱表面境界
    theta = np.random.uniform(0, 2*np.pi, N_boundary)
    x_cylinder = torch.FloatTensor(x_cyl &#43; r_cyl * np.cos(theta)).reshape(-1, 1).to(device)
    y_cylinder = torch.FloatTensor(y_cyl &#43; r_cyl * np.sin(theta)).reshape(-1, 1).to(device)
    t_cylinder = torch.FloatTensor(np.random.uniform(t_min, t_max, N_boundary)).reshape(-1, 1).to(device)
    
    # 初期条件(t = 0)
    x_init = []
    y_init = []
    
    while len(x_init) &lt; N_initial:
        x = np.random.uniform(x_min, x_max, N_initial * 2)
        y = np.random.uniform(y_min, y_max, N_initial * 2)
        
        mask = (x - x_cyl)**2 &#43; (y - y_cyl)**2 &gt; r_cyl**2
        x = x[mask]
        y = y[mask]
        
        x_init.extend(x[:N_initial - len(x_init)])
        y_init.extend(y[:N_initial - len(y_init)])
    
    x_init = torch.FloatTensor(x_init).reshape(-1, 1).to(device)
    y_init = torch.FloatTensor(y_init).reshape(-1, 1).to(device)
    t_init = torch.zeros(N_initial, 1).to(device)
    
    return (x_domain, y_domain, t_domain,
            x_inlet, y_inlet, t_inlet,
            x_outlet, y_outlet, t_outlet,
            x_wall_top, y_wall_top, t_wall_top,
            x_wall_bottom, y_wall_bottom, t_wall_bottom,
            x_cylinder, y_cylinder, t_cylinder,
            x_init, y_init, t_init)

# 可視化
def visualize_flow(pinn, t_value=2.0, save_path=&#39;flow_field.png&#39;):
    &#34;&#34;&#34;流れ場の可視化&#34;&#34;&#34;
    
    x = np.linspace(-2, 10, 150)
    y = np.linspace(-2, 2, 80)
    X, Y = np.meshgrid(x, y)
    
    x_flat = torch.FloatTensor(X.flatten()).reshape(-1, 1).to(device)
    y_flat = torch.FloatTensor(Y.flatten()).reshape(-1, 1).to(device)
    t_flat = torch.ones_like(x_flat) * t_value
    
    u, v, p = pinn.predict(x_flat, y_flat, t_flat)
    
    u = u.cpu().numpy().reshape(X.shape)
    v = v.cpu().numpy().reshape(X.shape)
    p = p.cpu().numpy().reshape(X.shape)
    
    # 円柱内部をマスク
    mask = (X - 0.0)**2 &#43; (Y - 0.0)**2 &lt; 0.5**2
    u[mask] = np.nan
    v[mask] = np.nan
    p[mask] = np.nan
    
    # 速度の大きさ
    velocity_magnitude = np.sqrt(u**2 &#43; v**2)
    
    fig, axes = plt.subplots(2, 2, figsize=(16, 8))
    
    # u速度
    im1 = axes[0, 0].contourf(X, Y, u, levels=20, cmap=&#39;RdBu_r&#39;)
    axes[0, 0].set_title(f&#39;u-velocity at t={t_value}&#39;)
    axes[0, 0].set_xlabel(&#39;x&#39;)
    axes[0, 0].set_ylabel(&#39;y&#39;)
    axes[0, 0].add_patch(plt.Circle((0, 0), 0.5, color=&#39;black&#39;))
    plt.colorbar(im1, ax=axes[0, 0])
    
    # v速度
    im2 = axes[0, 1].contourf(X, Y, v, levels=20, cmap=&#39;RdBu_r&#39;)
    axes[0, 1].set_title(f&#39;v-velocity at t={t_value}&#39;)
    axes[0, 1].set_xlabel(&#39;x&#39;)
    axes[0, 1].set_ylabel(&#39;y&#39;)
    axes[0, 1].add_patch(plt.Circle((0, 0), 0.5, color=&#39;black&#39;))
    plt.colorbar(im2, ax=axes[0, 1])
    
    # 圧力
    im3 = axes[1, 0].contourf(X, Y, p, levels=20, cmap=&#39;RdBu_r&#39;)
    axes[1, 0].set_title(f&#39;Pressure at t={t_value}&#39;)
    axes[1, 0].set_xlabel(&#39;x&#39;)
    axes[1, 0].set_ylabel(&#39;y&#39;)
    axes[1, 0].add_patch(plt.Circle((0, 0), 0.5, color=&#39;black&#39;))
    plt.colorbar(im3, ax=axes[1, 0])
    
    # 速度の大きさとストリームライン
    im4 = axes[1, 1].contourf(X, Y, velocity_magnitude, levels=20, cmap=&#39;viridis&#39;)
    axes[1, 1].streamplot(X, Y, u, v, color=&#39;white&#39;, linewidth=0.5, density=1.5)
    axes[1, 1].set_title(f&#39;Velocity magnitude at t={t_value}&#39;)
    axes[1, 1].set_xlabel(&#39;x&#39;)
    axes[1, 1].set_ylabel(&#39;y&#39;)
    axes[1, 1].add_patch(plt.Circle((0, 0), 0.5, color=&#39;black&#39;))
    plt.colorbar(im4, ax=axes[1, 1])
    
    plt.tight_layout()
    plt.savefig(save_path, dpi=150, bbox_inches=&#39;tight&#39;)
    plt.show()
    
    print(f&#34;Flow field visualization saved to {save_path}&#34;)

def plot_loss_history(pinn, save_path=&#39;loss_history.png&#39;):
    &#34;&#34;&#34;損失関数の履歴をプロット&#34;&#34;&#34;
    
    plt.figure(figsize=(10, 6))
    plt.plot(pinn.loss_history)
    plt.yscale(&#39;log&#39;)
    plt.xlabel(&#39;Iteration&#39;)
    plt.ylabel(&#39;Loss&#39;)
    plt.title(&#39;Training Loss History&#39;)
    plt.grid(True)
    plt.savefig(save_path, dpi=150, bbox_inches=&#39;tight&#39;)
    plt.show()
    
    print(f&#34;Loss history plot saved to {save_path}&#34;)

# メイン実行
if __name__ == &#34;__main__&#34;:
    # ハイパーパラメータ
    layers = [3, 64, 64, 64, 64, 3]  # [入力層, 隠れ層..., 出力層]
    Re = 100  # レイノルズ数
    epochs = 10000  # 訓練エポック数
    
    print(&#34;=&#34; * 60)
    print(&#34;2D Cylinder Flow Simulation using PINN&#34;)
    print(&#34;=&#34; * 60)
    print(f&#34;Reynolds number: {Re}&#34;)
    print(f&#34;Network architecture: {layers}&#34;)
    print(f&#34;Training epochs: {epochs}&#34;)
    print(&#34;=&#34; * 60)
    
    # PINNモデルの初期化
    pinn = NavierStokesPINN(layers, Re=Re)
    
    # 訓練データの生成
    print(&#34;\nGenerating training data...&#34;)
    training_data = generate_training_data(
        N_domain=5000,
        N_boundary=500,
        N_initial=1000
    )
    
    # モデルの訓練
    print(&#34;\nStarting training...&#34;)
    pinn.train(epochs, *training_data)
    
    # 損失関数の履歴をプロット
    print(&#34;\nPlotting loss history...&#34;)
    plot_loss_history(pinn, save_path=&#39;/workspace/outputs/loss_history.png&#39;)
    
    # 流れ場の可視化(複数の時刻)
    print(&#34;\nVisualizing flow fields...&#34;)
    for t in [0.5, 1.0, 2.0, 3.0]:
        visualize_flow(pinn, t_value=t, 
                      save_path=f&#39;/workspace/outputs/flow_field_t{t:.1f}.png&#39;)
    
    # モデルの保存
    torch.save(pinn.model.state_dict(), &#39;/workspace/outputs/pinn_cylinder_model.pth&#39;)
    print(&#34;\nModel saved to /workspace/outputs/pinn_cylinder_model.pth&#34;)
    
    print(&#34;\n&#34; &#43; &#34;=&#34; * 60)
    print(&#34;Simulation completed!&#34;)
    print(&#34;=&#34; * 60)
Execution results
Error History
">
<meta property="og:image" content="https://akenji3.github.io/img/avatar-icon.png" />
<meta property="og:url" content="https://akenji3.github.io/en/post/20260103_pinn-claude/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="akenji&#39;s lab" />

  <meta name="twitter:title" content="imulation of a Two-Dimensional Cylinder Wake by Claude" />
  <meta name="twitter:description" content="Introduction
Around this time last year, I spent two months working on a simulation of a two-dimensional cylindrical wake using PINNs. I hadn&rsquo;t finished working on this article.
This time, since …">
  <meta name="twitter:image" content="https://akenji3.github.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://akenji3.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.147.1">
  <link rel="alternate" href="https://akenji3.github.io/en/index.xml" type="application/rss+xml" title="akenji&#39;s lab"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css" integrity="sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="https://akenji3.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://akenji3.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://akenji3.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-TGXWYJXF48"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-TGXWYJXF48');
        }
      </script>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://akenji3.github.io/en/">akenji&#39;s lab</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/en/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/en/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Categories" href="/en/categories">Categories</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/en/tags">Tags</a>
            </li>
          
        

        
          
            <li>
              
                
                  <a href="https://akenji3.github.io/post/20260103_pinn-claude/">ja</a>
                
              
            </li>
          
        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="akenji&#39;s lab" href="https://akenji3.github.io/en/">
            <img class="avatar-img" src="https://akenji3.github.io/img/avatar-icon.png" alt="akenji&#39;s lab" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>imulation of a Two-Dimensional Cylinder Wake by Claude</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on January 3, 2026
  
  
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;
    
  
  &nbsp;&bull;&nbsp;Other languages: <a href="https://akenji3.github.io/post/20260103_pinn-claude/" lang="ja">ja</a>
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <h2 id="introduction">Introduction</h2>
<p>Around this time last year, I spent two months working on a simulation of a two-dimensional cylindrical wake using PINNs. I hadn&rsquo;t finished working on <a href="https://akenji3.github.io/en/post/20250321_2d_flowovercylinder/">this article</a>.
This time, since I built a <a href="https://akenji3.github.io/en/post/20260103_uv-docker/">new Python development environment</a>, I decided to tackle this theme as an example project, with Claude as my companion.</p>
<h2 id="code-generation">Code Generation</h2>
<h4 id="prompt">Prompt</h4>
<p>I had Claude generate the source code using the following prompt.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">Please generate PyTorch-based code to simulate the wake flow behind a two-dimensional cylinder using PINN.
</span></span></code></pre></div><h4 id="generated-code">Generated code</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># デバイスの設定</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Using device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ニューラルネットワークの定義</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PINN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">(</span><span class="n">PINN</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 入力の正規化</span>
</span></span><span class="line"><span class="cl">        <span class="n">inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">inputs</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 最終層(活性化関数なし)</span>
</span></span><span class="line"><span class="cl">        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">](</span><span class="n">inputs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 速度と圧力を出力</span>
</span></span><span class="line"><span class="cl">        <span class="n">u</span> <span class="o">=</span> <span class="n">output</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># x方向速度</span>
</span></span><span class="line"><span class="cl">        <span class="n">v</span> <span class="o">=</span> <span class="n">output</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># y方向速度</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span> <span class="o">=</span> <span class="n">output</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># 圧力</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Navier-Stokes方程式の残差計算</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">NavierStokesPINN</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="n">Re</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">PINN</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">Re</span> <span class="o">=</span> <span class="n">Re</span>  <span class="c1"># レイノルズ数</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">Re</span>  <span class="c1"># 動粘性係数</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 最適化アルゴリズム</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">StepLR</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.9</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">loss_history</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">net_NS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Navier-Stokes方程式の残差を計算&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">t</span><span class="o">.</span><span class="n">requires_grad_</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 1階微分</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">v_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">v_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">v_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">p_x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">p_y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 2階微分</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_xx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                    <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_yy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u_y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                    <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">v_xx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">v_x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">v_x</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                    <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">v_yy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">v_y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">v_y</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                    <span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Navier-Stokes方程式(運動量保存則)</span>
</span></span><span class="line"><span class="cl">        <span class="n">f_u</span> <span class="o">=</span> <span class="n">u_t</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">u_x</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">u_y</span> <span class="o">+</span> <span class="n">p_x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">*</span> <span class="p">(</span><span class="n">u_xx</span> <span class="o">+</span> <span class="n">u_yy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">f_v</span> <span class="o">=</span> <span class="n">v_t</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">v_x</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">v_y</span> <span class="o">+</span> <span class="n">p_y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">*</span> <span class="p">(</span><span class="n">v_xx</span> <span class="o">+</span> <span class="n">v_yy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 連続の式(質量保存則)</span>
</span></span><span class="line"><span class="cl">        <span class="n">f_cont</span> <span class="o">=</span> <span class="n">u_x</span> <span class="o">+</span> <span class="n">v_y</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">f_u</span><span class="p">,</span> <span class="n">f_v</span><span class="p">,</span> <span class="n">f_cont</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">loss_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_domain</span><span class="p">,</span> <span class="n">y_domain</span><span class="p">,</span> <span class="n">t_domain</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">x_inlet</span><span class="p">,</span> <span class="n">y_inlet</span><span class="p">,</span> <span class="n">t_inlet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">x_outlet</span><span class="p">,</span> <span class="n">y_outlet</span><span class="p">,</span> <span class="n">t_outlet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">x_wall_top</span><span class="p">,</span> <span class="n">y_wall_top</span><span class="p">,</span> <span class="n">t_wall_top</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">x_wall_bottom</span><span class="p">,</span> <span class="n">y_wall_bottom</span><span class="p">,</span> <span class="n">t_wall_bottom</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">x_cylinder</span><span class="p">,</span> <span class="n">y_cylinder</span><span class="p">,</span> <span class="n">t_cylinder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="n">x_init</span><span class="p">,</span> <span class="n">y_init</span><span class="p">,</span> <span class="n">t_init</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;損失関数の計算&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 領域内でのNavier-Stokes方程式の残差</span>
</span></span><span class="line"><span class="cl">        <span class="n">f_u</span><span class="p">,</span> <span class="n">f_v</span><span class="p">,</span> <span class="n">f_cont</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_NS</span><span class="p">(</span><span class="n">x_domain</span><span class="p">,</span> <span class="n">y_domain</span><span class="p">,</span> <span class="n">t_domain</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss_pde</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">f_u</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">f_v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">f_cont</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 入口境界条件(一様流)</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_inlet</span><span class="p">,</span> <span class="n">v_inlet</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x_inlet</span><span class="p">,</span> <span class="n">y_inlet</span><span class="p">,</span> <span class="n">t_inlet</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss_inlet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">u_inlet</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_inlet</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 出口境界条件(圧力ゼロ、速度の勾配ゼロに近似)</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_outlet</span><span class="p">,</span> <span class="n">v_outlet</span><span class="p">,</span> <span class="n">p_outlet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x_outlet</span><span class="p">,</span> <span class="n">y_outlet</span><span class="p">,</span> <span class="n">t_outlet</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss_outlet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p_outlet</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 上下壁境界条件(自由滑り)</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_wall_t</span><span class="p">,</span> <span class="n">v_wall_t</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x_wall_top</span><span class="p">,</span> <span class="n">y_wall_top</span><span class="p">,</span> <span class="n">t_wall_top</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_wall_b</span><span class="p">,</span> <span class="n">v_wall_b</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x_wall_bottom</span><span class="p">,</span> <span class="n">y_wall_bottom</span><span class="p">,</span> <span class="n">t_wall_bottom</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss_wall</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_wall_t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_wall_b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 円柱表面境界条件(無滑り条件)</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_cyl</span><span class="p">,</span> <span class="n">v_cyl</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x_cylinder</span><span class="p">,</span> <span class="n">y_cylinder</span><span class="p">,</span> <span class="n">t_cylinder</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss_cylinder</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">u_cyl</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_cyl</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 初期条件</span>
</span></span><span class="line"><span class="cl">        <span class="n">u_init</span><span class="p">,</span> <span class="n">v_init</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x_init</span><span class="p">,</span> <span class="n">y_init</span><span class="p">,</span> <span class="n">t_init</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">u_init</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_init</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 総損失</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_pde</span> <span class="o">+</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">loss_inlet</span> <span class="o">+</span> <span class="n">loss_outlet</span> <span class="o">+</span> <span class="n">loss_wall</span> <span class="o">+</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">loss_cylinder</span> <span class="o">+</span> <span class="n">loss_init</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">loss_pde</span><span class="p">,</span> <span class="n">loss_inlet</span><span class="p">,</span> <span class="n">loss_outlet</span><span class="p">,</span> <span class="n">loss_wall</span><span class="p">,</span> <span class="n">loss_cylinder</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">x_domain</span><span class="p">,</span> <span class="n">y_domain</span><span class="p">,</span> <span class="n">t_domain</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">x_inlet</span><span class="p">,</span> <span class="n">y_inlet</span><span class="p">,</span> <span class="n">t_inlet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">x_outlet</span><span class="p">,</span> <span class="n">y_outlet</span><span class="p">,</span> <span class="n">t_outlet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">x_wall_top</span><span class="p">,</span> <span class="n">y_wall_top</span><span class="p">,</span> <span class="n">t_wall_top</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">x_wall_bottom</span><span class="p">,</span> <span class="n">y_wall_bottom</span><span class="p">,</span> <span class="n">t_wall_bottom</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">x_cylinder</span><span class="p">,</span> <span class="n">y_cylinder</span><span class="p">,</span> <span class="n">t_cylinder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">x_init</span><span class="p">,</span> <span class="n">y_init</span><span class="p">,</span> <span class="n">t_init</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;モデルの訓練&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&#34;Training&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">pbar</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">loss</span><span class="p">,</span> <span class="n">loss_pde</span><span class="p">,</span> <span class="n">loss_inlet</span><span class="p">,</span> <span class="n">loss_outlet</span><span class="p">,</span> <span class="n">loss_wall</span><span class="p">,</span> <span class="n">loss_cylinder</span> <span class="o">=</span> \
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">loss_function</span><span class="p">(</span><span class="n">x_domain</span><span class="p">,</span> <span class="n">y_domain</span><span class="p">,</span> <span class="n">t_domain</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                 <span class="n">x_inlet</span><span class="p">,</span> <span class="n">y_inlet</span><span class="p">,</span> <span class="n">t_inlet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                 <span class="n">x_outlet</span><span class="p">,</span> <span class="n">y_outlet</span><span class="p">,</span> <span class="n">t_outlet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                 <span class="n">x_wall_top</span><span class="p">,</span> <span class="n">y_wall_top</span><span class="p">,</span> <span class="n">t_wall_top</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                 <span class="n">x_wall_bottom</span><span class="p">,</span> <span class="n">y_wall_bottom</span><span class="p">,</span> <span class="n">t_wall_bottom</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                 <span class="n">x_cylinder</span><span class="p">,</span> <span class="n">y_cylinder</span><span class="p">,</span> <span class="n">t_cylinder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                 <span class="n">x_init</span><span class="p">,</span> <span class="n">y_init</span><span class="p">,</span> <span class="n">t_init</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">loss_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;Loss&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s1">.4e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;PDE&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">loss_pde</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s1">.4e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;BC&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="p">(</span><span class="n">loss_inlet</span> <span class="o">+</span> <span class="n">loss_outlet</span> <span class="o">+</span> <span class="n">loss_wall</span> <span class="o">+</span> <span class="n">loss_cylinder</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s1">.4e</span><span class="si">}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="p">})</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;予測&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># サンプリング点の生成</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">generate_training_data</span><span class="p">(</span><span class="n">N_domain</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">N_boundary</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">N_initial</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;訓練データの生成&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 計算領域の定義</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">10.0</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_min</span><span class="p">,</span> <span class="n">t_max</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 円柱のパラメータ</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_cyl</span><span class="p">,</span> <span class="n">y_cyl</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">    <span class="n">r_cyl</span> <span class="o">=</span> <span class="mf">0.5</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 領域内のランダムサンプリング(円柱内部を除く)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_domain</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_domain</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_domain</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_domain</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">N_domain</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">N_domain</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">N_domain</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">t_min</span><span class="p">,</span> <span class="n">t_max</span><span class="p">,</span> <span class="n">N_domain</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># 円柱内部を除外</span>
</span></span><span class="line"><span class="cl">        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_cyl</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_cyl</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">r_cyl</span><span class="o">**</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">x_domain</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">N_domain</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_domain</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">        <span class="n">y_domain</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="n">N_domain</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_domain</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">        <span class="n">t_domain</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="n">N_domain</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_domain</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">x_domain</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">x_domain</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_domain</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">y_domain</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_domain</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">t_domain</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 入口境界(x = x_min)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_inlet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N_boundary</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_min</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_inlet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">N_boundary</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_inlet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">t_min</span><span class="p">,</span> <span class="n">t_max</span><span class="p">,</span> <span class="n">N_boundary</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 出口境界(x = x_max)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_outlet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N_boundary</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_max</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_outlet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">N_boundary</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_outlet</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">t_min</span><span class="p">,</span> <span class="n">t_max</span><span class="p">,</span> <span class="n">N_boundary</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 上壁境界(y = y_max)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_wall_top</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">N_boundary</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_wall_top</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N_boundary</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_max</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_wall_top</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">t_min</span><span class="p">,</span> <span class="n">t_max</span><span class="p">,</span> <span class="n">N_boundary</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 下壁境界(y = y_min)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_wall_bottom</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">N_boundary</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_wall_bottom</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N_boundary</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_min</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_wall_bottom</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">t_min</span><span class="p">,</span> <span class="n">t_max</span><span class="p">,</span> <span class="n">N_boundary</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 円柱表面境界</span>
</span></span><span class="line"><span class="cl">    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">N_boundary</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_cylinder</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">x_cyl</span> <span class="o">+</span> <span class="n">r_cyl</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_cylinder</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">y_cyl</span> <span class="o">+</span> <span class="n">r_cyl</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_cylinder</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">t_min</span><span class="p">,</span> <span class="n">t_max</span><span class="p">,</span> <span class="n">N_boundary</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 初期条件(t = 0)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x_init</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_init</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_init</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">N_initial</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">N_initial</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">N_initial</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_cyl</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_cyl</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">&gt;</span> <span class="n">r_cyl</span><span class="o">**</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">x_init</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">N_initial</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_init</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">        <span class="n">y_init</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="n">N_initial</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_init</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">x_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">x_init</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">y_init</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_initial</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">x_domain</span><span class="p">,</span> <span class="n">y_domain</span><span class="p">,</span> <span class="n">t_domain</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">x_inlet</span><span class="p">,</span> <span class="n">y_inlet</span><span class="p">,</span> <span class="n">t_inlet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">x_outlet</span><span class="p">,</span> <span class="n">y_outlet</span><span class="p">,</span> <span class="n">t_outlet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">x_wall_top</span><span class="p">,</span> <span class="n">y_wall_top</span><span class="p">,</span> <span class="n">t_wall_top</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">x_wall_bottom</span><span class="p">,</span> <span class="n">y_wall_bottom</span><span class="p">,</span> <span class="n">t_wall_bottom</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">x_cylinder</span><span class="p">,</span> <span class="n">y_cylinder</span><span class="p">,</span> <span class="n">t_cylinder</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">x_init</span><span class="p">,</span> <span class="n">y_init</span><span class="p">,</span> <span class="n">t_init</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 可視化</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">visualize_flow</span><span class="p">(</span><span class="n">pinn</span><span class="p">,</span> <span class="n">t_value</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s1">&#39;flow_field.png&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;流れ場の可視化&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">x_flat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_flat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_flat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_flat</span><span class="p">)</span> <span class="o">*</span> <span class="n">t_value</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pinn</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_flat</span><span class="p">,</span> <span class="n">y_flat</span><span class="p">,</span> <span class="n">t_flat</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 円柱内部をマスク</span>
</span></span><span class="line"><span class="cl">    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Y</span> <span class="o">-</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="o">**</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="n">u</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="cl">    <span class="n">v</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 速度の大きさ</span>
</span></span><span class="line"><span class="cl">    <span class="n">velocity_magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># u速度</span>
</span></span><span class="line"><span class="cl">    <span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;u-velocity at t=</span><span class="si">{</span><span class="n">t_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># v速度</span>
</span></span><span class="line"><span class="cl">    <span class="n">im2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;v-velocity at t=</span><span class="si">{</span><span class="n">t_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 圧力</span>
</span></span><span class="line"><span class="cl">    <span class="n">im3</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Pressure at t=</span><span class="si">{</span><span class="n">t_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 速度の大きさとストリームライン</span>
</span></span><span class="line"><span class="cl">    <span class="n">im4</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">velocity_magnitude</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Velocity magnitude at t=</span><span class="si">{</span><span class="n">t_value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Flow field visualization saved to </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">plot_loss_history</span><span class="p">(</span><span class="n">pinn</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s1">&#39;loss_history.png&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;損失関数の履歴をプロット&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pinn</span><span class="o">.</span><span class="n">loss_history</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Loss&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Training Loss History&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Loss history plot saved to </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># メイン実行</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ハイパーパラメータ</span>
</span></span><span class="line"><span class="cl">    <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># [入力層, 隠れ層..., 出力層]</span>
</span></span><span class="line"><span class="cl">    <span class="n">Re</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># レイノルズ数</span>
</span></span><span class="line"><span class="cl">    <span class="n">epochs</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># 訓練エポック数</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;2D Cylinder Flow Simulation using PINN&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Reynolds number: </span><span class="si">{</span><span class="n">Re</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Network architecture: </span><span class="si">{</span><span class="n">layers</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Training epochs: </span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># PINNモデルの初期化</span>
</span></span><span class="line"><span class="cl">    <span class="n">pinn</span> <span class="o">=</span> <span class="n">NavierStokesPINN</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="n">Re</span><span class="o">=</span><span class="n">Re</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 訓練データの生成</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Generating training data...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">training_data</span> <span class="o">=</span> <span class="n">generate_training_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">N_domain</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">N_boundary</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">N_initial</span><span class="o">=</span><span class="mi">1000</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># モデルの訓練</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Starting training...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">pinn</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="o">*</span><span class="n">training_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 損失関数の履歴をプロット</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Plotting loss history...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot_loss_history</span><span class="p">(</span><span class="n">pinn</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="s1">&#39;/workspace/outputs/loss_history.png&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 流れ場の可視化(複数の時刻)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Visualizing flow fields...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="n">visualize_flow</span><span class="p">(</span><span class="n">pinn</span><span class="p">,</span> <span class="n">t_value</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                      <span class="n">save_path</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;/workspace/outputs/flow_field_t</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># モデルの保存</span>
</span></span><span class="line"><span class="cl">    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">pinn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s1">&#39;/workspace/outputs/pinn_cylinder_model.pth&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Model saved to /workspace/outputs/pinn_cylinder_model.pth&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Simulation completed!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="execution-results">Execution results</h2>
<h4 id="error-history">Error History</h4>
<p><img src="/images/20260103_PINN/20260103_loss_history.png" alt="loss_history"></p>
<h4 id="visualization">Visualization</h4>
<p><img src="/images/20260103_PINN/20260103_flow_field_t3.0.png" alt="flow_field_t3.0"></p>
<h2 id="summary">Summary</h2>
<p>I&rsquo;m surprised results came so easily. It makes last year&rsquo;s hard work feel wasted. Well, I suppose last year&rsquo;s experience was a learning opportunity.</p>
<p>I want to analyze the generated code a bit more.</p>


        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20260103_pinn-claude%2f&amp;text=imulation%20of%20a%20Two-Dimensional%20Cylinder%20Wake%20by%20Claude&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20260103_pinn-claude%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20260103_pinn-claude%2f&amp;title=imulation%20of%20a%20Two-Dimensional%20Cylinder%20Wake%20by%20Claude" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20260103_pinn-claude%2f&amp;title=imulation%20of%20a%20Two-Dimensional%20Cylinder%20Wake%20by%20Claude" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20260103_pinn-claude%2f&amp;title=imulation%20of%20a%20Two-Dimensional%20Cylinder%20Wake%20by%20Claude" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20260103_pinn-claude%2f&amp;description=imulation%20of%20a%20Two-Dimensional%20Cylinder%20Wake%20by%20Claude" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://akenji3.github.io/en/post/20251115_astrophoto/" data-toggle="tooltip" data-placement="top" title="Capturing the Galaxy with RicoRem(Ricoh&#39;s remote telescope)">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://akenji3.github.io/en/post/20260103_uv-docker/" data-toggle="tooltip" data-placement="top" title="Connecting to a Python development environment in a remote Docker container from VSCode">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2026
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://akenji3.github.io/en/">akenji&#39;s lab</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.147.1</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://akenji3.github.io/js/main.js"></script>
<script src="https://akenji3.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://akenji3.github.io/js/load-photoswipe.js"></script>










    
  </body>
</html>

