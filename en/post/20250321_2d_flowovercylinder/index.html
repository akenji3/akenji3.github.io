<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Simulation of 2D flow over cylinder - akenji&#39;s lab</title>
  <meta name="description" content="Introduction
Two months ago in this post, laminar flow around a 2D circular cylinder (Laminar Flow), using the governing equations for each of the ST and VP forms, The simulation was performed using the governing equations for each of the ST form and VP form.
Since then, we have simulated the flow around a 2-D cylinder in the time range 0 to 60 seconds for various parameters, and the results are summarized here.">
  <meta name="author" content="Kenji Arai"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "akenji\u0027s lab",
    
    "url": "https:\/\/akenji3.github.io"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/akenji3.github.io"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/akenji3.github.io",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/akenji3.github.io\/en\/post\/20250321_2d_flowovercylinder\/",
          "name": "Simulation of 2 d flow over cylinder"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Kenji Arai"
  },
  "headline": "Simulation of 2D flow over cylinder",
  "description" : "Introduction Two months ago in this post, laminar flow around a 2D circular cylinder (Laminar Flow), using the governing equations for each of the ST and VP forms, The simulation was performed using the governing equations for each of the ST form and VP form.\nSince then, we have simulated the flow around a 2-D cylinder in the time range 0 to 60 seconds for various parameters, and the results are summarized here.\n",
  "inLanguage" : "en",
  "wordCount":  3885 ,
  "datePublished" : "2025-03-21T00:00:00",
  "dateModified" : "2025-03-21T00:00:00",
  "image" : "https:\/\/akenji3.github.io\/img\/avatar-icon.png",
  "keywords" : [ "" ],
  "mainEntityOfPage" : "https:\/\/akenji3.github.io\/en\/post\/20250321_2d_flowovercylinder\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/akenji3.github.io",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/akenji3.github.io\/img\/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Simulation of 2D flow over cylinder" />
<meta property="og:description" content="Introduction
Two months ago in this post, laminar flow around a 2D circular cylinder (Laminar Flow), using the governing equations for each of the ST and VP forms, The simulation was performed using the governing equations for each of the ST form and VP form.
Since then, we have simulated the flow around a 2-D cylinder in the time range 0 to 60 seconds for various parameters, and the results are summarized here.">
<meta property="og:image" content="https://akenji3.github.io/img/avatar-icon.png" />
<meta property="og:url" content="https://akenji3.github.io/en/post/20250321_2d_flowovercylinder/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="akenji&#39;s lab" />

  <meta name="twitter:title" content="Simulation of 2D flow over cylinder" />
  <meta name="twitter:description" content="Introduction
Two months ago in this post, laminar flow around a 2D circular cylinder (Laminar Flow), using the governing equations for each of the ST and VP forms, The simulation was performed using …">
  <meta name="twitter:image" content="https://akenji3.github.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@akenji3" />
  <meta name="twitter:creator" content="@akenji3" />
  <link href='https://akenji3.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.74.3" />
  <link rel="alternate" href="https://akenji3.github.io/en/index.xml" type="application/rss+xml" title="akenji&#39;s lab"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://akenji3.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://akenji3.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://akenji3.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



<meta name="google-site-verification" content="j8CZGVXeJvndIocFmzuHgNW2yAd7f30cM9gMYPGqDpE" />


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-TGXWYJXF48', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://akenji3.github.io/en/">akenji&#39;s lab</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/en">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/en/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Categories" href="/en/categories">Categories</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/en/tags">Tags</a>
            </li>
          
        

        
          
            <li>
              
                
              
                
                  <a href="/ja" lang="ja">ja</a>
                
              
            </li>
          
        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="akenji&#39;s lab" href="https://akenji3.github.io/en/">
            <img class="avatar-img" src="https://akenji3.github.io/img/avatar-icon.png" alt="akenji&#39;s lab" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Simulation of 2D flow over cylinder</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on March 21, 2025
  
  
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Kenji Arai
    
  
  &nbsp;&bull;&nbsp;Other languages: <a href="https://akenji3.github.io/post/20250321_2d_flowovercylinder/" lang="ja">ja</a>
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <h2 id="introduction">Introduction</h2>
<p>Two months ago <a href="https://akenji3.github.io/en/post/20250123_unsteady_laminar/">in this post</a>, laminar flow around a 2D circular cylinder (Laminar Flow), using the governing equations for each of the ST and VP forms, The simulation was performed using the governing equations for each of the ST form and VP form.</p>
<p>Since then, we have simulated the flow around a 2-D cylinder in the time range 0 to 60 seconds for various parameters, and the results are summarized here.</p>
<h2 id="sources">Sources</h2>
<ol>
<li><a href="https://www.mdpi.com/1996-1073/16/12/4558">Physics-Informed Neural Networks for Low Reynolds Number Flows over Cylinder</a>  -  I proceeded by referring to the computational domain of this paper. The description of the wall boundary condition was “the freestream baoundary condition of 1 m/s” in the description of Figure 4. The description of the number of hidden layers was also helpful, along with the figure in Figure 9. There is no source code, but from the description of the governing equations of the fluid, it seems to be solved in VP type. the Input of the overall picture in Figure 2. has a description of time $t$, but no time axis.</li>
<li><a href="https://arxiv.org/abs/2205.14249">Experience report of physics-informed neural networks in fluid simulations: pitfalls and frustration</a>  -  I referred to this paper for the boundary conditions, the number of nodes in the hidden layer, and the number of layers (layers). Note that this paper was written about a year before that paper, by the same author as source 1. of <a href="https://akenji3.github.io/en/post/20250124_karmanvortex/">Kalman Vortex with OpenFOAM</a>, which I posted a while ago.</li>
<li><a href="https://wiki.openfoam.com/Vortex_shedding_by_Joel_Guerrero_2D">Vortex shedding by Joel Guerrero 2D</a> - The tutorial “2D Circular cylinder - Vortex shedding” can be found on this page. Initially, the simulation was done in PINNs to match the computational domain of this tutorial. This page is introduced in the source 6. of the contribution with <a href="https://akenji3.github.io/en/post/20250124_karmanvortex/">Kalman vortex with OpenFOAM</a>.</li>
<li><a href="https://zenn.dev/ksttr/scraps/603a18a5b0ebc2">Summary of PINN Devices</a>  -  Links to resources that can give you tips on what to do if your learning is not going well with PINN. Using this as a starting point, I did a lot of research on “failure mode”.</li>
</ol>
<h2 id="background">Background</h2>
<p>The parameters were changed according to the following process. The results should be judged by looking at the time history of the velocity field/pressure field, and judging the natural one with sensitivity, and comparing it with the output of OpenFOAM, etc. However, I could not go that far this time.</p>
<h5 id="1-change-of-calculation-domain">1. Change of calculation domain</h5>
<p>At first, in order to compare simulation results, I started with the computational domain of the tutorial in source 6. of <a href="https://akenji3.github.io/en/post/20250124_karmanvortex/">OpenFOAM</a>. No good results were obtained, and once to check for errors in the code, the simulation was conducted in the computation domain in <a href="https://akenji3.github.io/en/post/20250115_unsteady/">this post</a>. As a result, I decided to run the simulation in ST form since the results were better in ST form.</p>
<p>For the computational domain, the back of the cylinder was lengthened in accordance with Source 1. In the case of U_max=5 (Re=200), relatively good results were obtained for the velocity field, but the pressure field was skewed in the y direction. ), both the velocity and pressure fields were significantly disturbed.</p>
<p>For the upper and lower walls, the slip condition (U_max value in the u direction and zero in the v direction) gave relatively good results for both the velocity and pressure fields.</p>
<h5 id="2-change-hidden-layer-increase-hidden-layer">2. change hidden layer (increase hidden layer)</h5>
<p>The simulation results in ST form showed relatively good results for the u and v velocity components, but I was concerned about the extension to the front of the cylinder (INLET side) (I call this the nose), so I looked into it and found that in the explanation of Figure 9. in Source 1., “When the hidden layer is 10, the tip is not accurately reproduced and the description was “The tip cannot be accurately reproduced when the number of hidden layers is 10. I decided to increase the number of hidden layers.</p>
<h5 id="3-response-to-the-lack-of-convergence">3. Response to the lack of convergence</h5>
<p>The hidden layer was implemented with 50 nodes x 13 layers, but it was implemented with 50 nodes x 20 layers and 25 layers. Then, even after 20,000 loops (epoch=20,000), the error both INLET and WALL did not move from 1.0, and the phenomenon did not converge.</p>
<p>Referring to the information source 4., I tried various countermeasures such as weighting the error (loss term), initializing the network with “xavier,” and so on.</p>
<p>As a result, when the model was run with 50 nodes x 25 hidden layers and epoch=50,000, the error both INLET and WALL decreased drastically from 1.0 after 20,000 times, showing a convergence trend. The results inferred from the model were different from what was expected for both the velocity and pressure fields. In particular, the velocity field was tilted in the u-direction, whereas it was originally tilted in the v-direction.</p>
<h5 id="4-change-the-hidden-layer-increase-the-number-of-nodes">4. Change the hidden layer (increase the number of nodes)</h5>
<p>Since I could not obtain very good results with 50 nodes, we tried 256 nodes/512 nodes x 6 layers/8 layers, referring to Source 2. Finally, 256 nodes x 8 layers gave the best results.</p>
<h2 id="parameters">Parameters</h2>
<p>As described in the background, the hidden layer, boundary conditions, collocation point, number of iterations (epoch), etc. were changed in various ways, but in the following code, simulations were performed with the following parameter settings.</p>
<p>For the collocation point, please refer to the code in the “Setting the problem domain (variables and constants)” section.</p>
<table>
<thead>
<tr>
<th>Parameters</th>
<th>Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td>hidden layers</td>
<td>256ｘ256 node<!-- raw HTML omitted -->8 layers</td>
</tr>
<tr>
<td>INLET</td>
<td>1.0 （U_max=1.0m/s flow in x direction）</td>
</tr>
<tr>
<td>WALL（upper and lower boundaries）</td>
<td>slip condition（U_max flow in x direction）</td>
</tr>
<tr>
<td>OUTLET</td>
<td>pressure zero</td>
</tr>
<tr>
<td>epoch</td>
<td>100,000 times</td>
</tr>
</tbody>
</table>
<h2 id="code">Code</h2>
<p>Some parts are the same as in <a href="https://akenji3.github.io/en/post/20250115_unsteady/">this post</a>, but I will post the code again.</p>
<h4 id="import-package">import package</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="kn">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="kn">as</span> <span class="nn">F</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">optim</span>
<span class="kn">from</span> <span class="nn">torch.optim</span> <span class="kn">import</span> <span class="n">lr_scheduler</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>

<span class="kn">from</span> <span class="nn">pyDOE</span> <span class="kn">import</span> <span class="n">lhs</span>  <span class="c1"># Latin Hypercube Sampling (LHS)</span>

<span class="kn">import</span> <span class="nn">subprocess</span>
</code></pre></div><h4 id="confirmation-that-we-are-using-cuda">Confirmation that we are using CUDA</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Exit if not run on cuda</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Exit because of running on cpu</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">EX_OK</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;cuda&#39;</span>  <span class="c1"># device is used later</span>

<span class="c1"># We are running on cuda</span>
<span class="n">cmd</span> <span class="o">=</span> <span class="s2">&#34;nvidia-smi --query-gpu=name --format=csv,noheader&#34;</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;Running on&#34;</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</code></pre></div><p>In rare cases, CUDA is not recognized and the CPU is used for execution. So, if CUDA was not found, we would stop execution.</p>
<h4 id="define-function">Define function</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Remove points inside the cylinder from collocation points</span>
<span class="c1">#  Find the distance between the center of the cylinder (xc, yc) and a point,</span>
<span class="c1">#  and delete anything less than the cylinder radius (r).</span>
<span class="k">def</span> <span class="nf">Remove_inCylinder</span><span class="p">(</span><span class="n">coor</span><span class="p">,</span> <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([((</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="n">coor</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">coor</span><span class="p">[</span><span class="n">distance</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">,</span> <span class="p">:]</span>
</code></pre></div><h4 id="define-reynolds-number">Define Reynolds number</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Define Re</span>

<span class="n">U_max</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># flow velocity</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">0.0005</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Re=200=(uxD)/nu=(1x0.1)/0.0005, nu=mu/rho</span>
</code></pre></div><h4 id="define-problem-domain-variables-constants">Define problem domain (variables, constants)</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Define variables to represent computation domains</span>

<span class="c1"># Some constants</span>
<span class="n">IC_samples</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">wall_samples</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">cylinder_samples</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">inlet_samples</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">outlet_samples</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="c1"># Domain bounds</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">ymin</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">tmin</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">tmax</span> <span class="o">=</span> <span class="mf">60.0</span>
<span class="n">lb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">tmin</span><span class="p">])</span>
<span class="n">ub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">tmax</span><span class="p">])</span>

<span class="c1"># cylinder</span>
<span class="n">dia</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># diameter</span>
<span class="n">radi</span> <span class="o">=</span> <span class="n">dia</span><span class="o">/</span><span class="mf">2.0</span>  <span class="c1"># radius</span>
<span class="n">xcent</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># center in x-axis</span>
<span class="n">ycent</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># cneter in y-axis</span>

<span class="c1"># constants for refinement area and near wall area</span>
<span class="n">xrefmin</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">yrefmin</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">xrefmax</span> <span class="o">=</span> <span class="mf">3.5</span>
<span class="n">yrefmax</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">near_w</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="c1"># Inital Condition: </span>
<span class="c1">#  (u, v, p) = (0, 0, 0)　at t= 0, x ∈ [xmin, xmax], y ∈ [ymin, ymax]</span>

<span class="n">xy_IC</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]</span> <span class="o">*</span> <span class="n">lhs</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">IC_samples</span><span class="p">)</span>
<span class="n">t_IC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">IC_samples</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">IC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xy_IC</span><span class="p">,</span> <span class="n">t_IC</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">IC</span> <span class="o">=</span> <span class="n">Remove_inCylinder</span><span class="p">(</span><span class="n">IC</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="n">xcent</span><span class="p">,</span> <span class="n">yc</span><span class="o">=</span><span class="n">ycent</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">radi</span><span class="p">)</span>

<span class="c1"># define floor and ceiling, we called wall</span>
<span class="c1">#   celling(x,y,t): (xmin, ymin ,tmin)-(xmax, ymax, tmax)</span>
<span class="c1">#   floor(x,y,t): (xmin, ymin, tmin)-(xmax, ymin, tmax)</span>
<span class="c1"># N.B. we give the constant flow at the wall.</span>
<span class="n">CEILING</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">tmin</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">]</span> <span class="o">*</span> <span class="n">lhs</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">wall_samples</span><span class="p">)</span>
<span class="n">x_CEILING</span> <span class="o">=</span> <span class="n">CEILING</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="n">u_CEILING</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_CEILING</span><span class="p">)</span>
<span class="n">u_CEILING</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">U_max</span><span class="p">)</span>
<span class="n">v_CEILING</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u_CEILING</span>
<span class="n">CEILING</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">CEILING</span><span class="p">,</span> <span class="n">u_CEILING</span><span class="p">,</span> <span class="n">v_CEILING</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">FLOOR</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">tmin</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">]</span> <span class="o">*</span> <span class="n">lhs</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">wall_samples</span><span class="p">)</span>
<span class="n">x_FLOOR</span> <span class="o">=</span> <span class="n">FLOOR</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="n">u_FLOOR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x_FLOOR</span><span class="p">)</span>
<span class="n">u_FLOOR</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">U_max</span><span class="p">)</span>
<span class="n">v_FLOOR</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">u_FLOOR</span>
<span class="n">FLOOR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">FLOOR</span><span class="p">,</span> <span class="n">u_FLOOR</span><span class="p">,</span> <span class="n">v_FLOOR</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">WALL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">CEILING</span><span class="p">,</span> <span class="n">FLOOR</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Define cylinder surface</span>
<span class="n">rt_CYLD</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tmin</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">tmax</span><span class="p">]</span> <span class="o">*</span> <span class="n">lhs</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">cylinder_samples</span><span class="p">)</span>
<span class="n">x_CYLD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">radi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rt_CYLD</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="n">xcent</span>
<span class="n">y_CYLD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">radi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rt_CYLD</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="n">ycent</span>
<span class="n">CYLD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x_CYLD</span><span class="p">,</span> <span class="n">y_CYLD</span><span class="p">,</span> <span class="n">rt_CYLD</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Define INLET</span>
<span class="n">INLET</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">tmin</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">tmax</span><span class="p">]</span> <span class="o">*</span> <span class="n">lhs</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">inlet_samples</span><span class="p">)</span>
<span class="n">y_INLET</span> <span class="o">=</span> <span class="n">INLET</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">t_INLET</span> <span class="o">=</span> <span class="n">INLET</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">u_INLET</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">y_INLET</span><span class="p">)</span>
<span class="n">u_INLET</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">U_max</span><span class="p">)</span>
<span class="n">v_INLET</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">u_INLET</span><span class="p">)</span>
<span class="n">INLET</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">INLET</span><span class="p">,</span> <span class="n">u_INLET</span><span class="p">,</span> <span class="n">v_INLET</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Define OUTLET</span>
<span class="n">OUTLET</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">tmin</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">tmax</span><span class="p">]</span> <span class="o">*</span> <span class="n">lhs</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">outlet_samples</span><span class="p">)</span>

<span class="c1"># Define Collocation points, with refinement near the wall</span>
<span class="n">collo_samples</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">refine_samples</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">near_samples</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="s2">&#34;&#34;&#34;
</span><span class="s2">xyt_Collo = lb + (ub - lb) * lhs(3, collo_samples)
</span><span class="s2">xyt_refine = [xrefmin, yrefmin, tmin] + [xrefmax-xrefmin, yrefmax-xrefmin, tmax] * lhs(3, refine_samples)
</span><span class="s2">xyt_floor = [xmin, ymin, tmin] + [xmax, near_w, tmax] * lhs(3, near_samples)
</span><span class="s2">xyt_ceiling = [xmin, ymax-near_w, tmin] + [xmax, near_w, tmax] * lhs(3, near_samples)
</span><span class="s2">Collo = np.concatenate((xyt_Collo, xyt_refine, xyt_floor, xyt_ceiling), 0)
</span><span class="s2">&#34;&#34;&#34;</span>
<span class="n">collo_samples</span> <span class="o">=</span> <span class="mi">20000</span>
<span class="n">Collo</span> <span class="o">=</span> <span class="n">lb</span> <span class="o">+</span> <span class="p">(</span><span class="n">ub</span> <span class="o">-</span> <span class="n">lb</span><span class="p">)</span> <span class="o">*</span> <span class="n">lhs</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">collo_samples</span><span class="p">)</span>
<span class="n">Collo</span> <span class="o">=</span> <span class="n">Remove_inCylinder</span><span class="p">(</span><span class="n">Collo</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="n">xcent</span><span class="p">,</span> <span class="n">yc</span><span class="o">=</span><span class="n">ycent</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">radi</span><span class="p">)</span>
</code></pre></div><p>In the calculation area (collocation), the effect of the points around the cylinder and around the wall was questionable, so it was removed.</p>
<h4 id="visualize-collocation-points">Visualize collocation points</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Visualize the collocation points in (x, y, t）</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>

<span class="c1"># 2D</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Collo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">Collo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">IC</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">IC</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">WALL</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">WALL</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">CYLD</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">CYLD</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">OUTLET</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">OUTLET</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">INLET</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">INLET</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Collocation points&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="c1"># 3D</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="c1">#ax2.set_aspect(&#39;equal&#39;)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Collo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">Collo</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">Collo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;greenyellow&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">WALL</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">WALL</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">WALL</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">CYLD</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">CYLD</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">CYLD</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">OUTLET</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">OUTLET</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">OUTLET</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">INLET</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">INLET</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">INLET</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Collocation points&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div><h4 id="tensorize-variables-used-for-training">Tensorize variables used for training</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Define collocation, INLET, OUTLET, and WALL variables as torch.tensor</span>
<span class="n">x_c</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">Collo</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y_c</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">Collo</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">t_c</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">Collo</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">x_IC</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">IC</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y_IC</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">IC</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">t_IC</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">IC</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">x_INLET</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">INLET</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y_INLET</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">INLET</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">t_INLET</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">INLET</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">u_INLET</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">INLET</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">v_INLET</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">INLET</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">x_OUTLET</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">OUTLET</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y_OUTLET</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">OUTLET</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">t_OUTLET</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">OUTLET</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>


<span class="n">x_WALL</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">WALL</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y_WALL</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">WALL</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">t_WALL</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">WALL</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">u_WALL</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">WALL</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">v_WALL</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">WALL</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">x_CYLD</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">CYLD</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">y_CYLD</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">CYLD</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">t_CYLD</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">CYLD</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div><h4 id="create-a-fully-connected-layer-network-class">Create a fully-connected layer network class</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># define p_NN class</span>

<span class="k">class</span> <span class="nc">p_NN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">()</span>
<span class="c1">#        self.activation = nn.ReLU()        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">layers</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span>
            <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        # xavier initialization
</span><span class="s2">        for i in range(len(self.hidden_layers)):
</span><span class="s2">            nn.init.xavier_normal_(self.hidden_layers[i].weight.data, gain=1.0)
</span><span class="s2">            nn.init.zeros_(self.hidden_layers[i].bias.data)
</span><span class="s2">        &#34;&#34;&#34;</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_layer</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_layers</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">neural_net</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">s11</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">s22</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">s12</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">psi</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s12</span>

    <span class="k">def</span> <span class="nf">net_uvp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">x</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">y</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">t</span><span class="o">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">psi</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neural_net</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">gradients</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s12</span>
     
    <span class="k">def</span> <span class="nf">net_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_uvp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>       
        <span class="n">u_x</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">u_y</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">u_t</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">s11_x</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">s11</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">s12_y</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">s12</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">fu</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="n">u_t</span> <span class="o">+</span> <span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">u_x</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">u_y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">s11_x</span> <span class="o">+</span> <span class="n">s12_y</span><span class="p">)</span>

        <span class="n">v_x</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">v_y</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">v_t</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">s12_x</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">s12</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">s22_y</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">(</span><span class="n">s22</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="n">rho</span><span class="o">*</span><span class="n">v_t</span> <span class="o">+</span> <span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">v_x</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">v_y</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">s12_x</span> <span class="o">+</span> <span class="n">s22_y</span><span class="p">)</span>

        <span class="n">fxx</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span> <span class="o">+</span> <span class="n">mu</span><span class="o">*</span><span class="mf">2.0</span><span class="o">*</span><span class="n">u_x</span> <span class="o">-</span> <span class="n">s11</span>
        <span class="n">fyy</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span> <span class="o">+</span> <span class="n">mu</span><span class="o">*</span><span class="mf">2.0</span><span class="o">*</span><span class="n">v_y</span> <span class="o">-</span> <span class="n">s22</span>
        <span class="n">fxy</span> <span class="o">=</span> <span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="n">u_y</span> <span class="o">+</span> <span class="n">v_x</span><span class="p">)</span> <span class="o">-</span> <span class="n">s12</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="n">s11</span> <span class="o">+</span> <span class="n">s22</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>

        <span class="k">return</span> <span class="n">fu</span><span class="p">,</span> <span class="n">fv</span><span class="p">,</span> <span class="n">fxx</span><span class="p">,</span> <span class="n">fyy</span><span class="p">,</span> <span class="n">fxy</span><span class="p">,</span> <span class="n">fp</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>  <span class="c1"># no tensor is passed, return no tensor</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">tt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">uu</span><span class="p">,</span> <span class="n">vv</span><span class="p">,</span> <span class="n">pp</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net_uvp</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">tt</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">uu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&#34;cpu&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">vv</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&#34;cpu&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&#34;cpu&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span>
</code></pre></div><p>I tried to initialize the network with xavier, but it didn&rsquo;t work, so I commented it out.</p>
<h4 id="define-differential-function">Define differential function</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Differentiation by pytorch</span>
<span class="c1"># return dy/dx</span>
<span class="k">def</span> <span class="nf">gradients</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">y</span><span class="p">,</span>
                               <span class="n">x</span><span class="p">,</span>
                               <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
                               <span class="n">create_graph</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                              <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div><h4 id="create-a-modelinstantiate">Create a model（Instantiate）</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Create a Model</span>
<span class="c1">#  Input: (x, y, t)</span>
<span class="c1">#  hidden: 20-layer　ｘ　50-node</span>
<span class="c1">#  Output: (phi, p, s1, s2, s3)</span>
<span class="c1">#uv_layers = [3]+20*[50]+[5]</span>
<span class="c1">#uv_layers = [3]+13*[50]+[5]</span>
<span class="c1">#uv_layers = [3]+14*[50]+[5]</span>
<span class="c1">#uv_layers = [3]+15*[50]+[5]</span>
<span class="c1">#uv_layers = [3]+10*[50]+[5]</span>
<span class="c1">#uv_layers = [3]+[32]+[64]+[128]+[128]+[64]+[32]+[5]</span>
<span class="c1">#uv_layers = [3]+[32]+[64]+[128]+[256]+[256]+[128]+[64]+[32]+[5]</span>
<span class="c1">#uv_layers = [3]+15*[60]+[5]</span>

<span class="n">uv_layers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="o">*</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">p_NN</span><span class="p">(</span><span class="n">uv_layers</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div><h4 id="define-loss-function-and-optimizer-function">Define loss function and optimizer function</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Loss function: Mean Square Error</span>
<span class="n">loss_func</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>

<span class="c1"># Optimizer: Adam(Adaptive moment estimation)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.005</span><span class="p">)</span>

<span class="n">scheduler</span> <span class="o">=</span> <span class="n">lr_scheduler</span><span class="o">.</span><span class="n">ExponentialLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>
</code></pre></div><p>As before, loss_func() is not used. Added a function to vary the learning rate.</p>
<h4 id="start-timer-to-measure-the-time-of-the-learning-loop">Start timer to measure the time of the learning loop</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#　Measure processing time</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</code></pre></div><h4 id="learning-loop">Learning loop</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># learning Loop</span>

<span class="n">Lamb_iw</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Lamb_ot</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">num_epoch</span> <span class="o">=</span> <span class="mi">100000</span>  <span class="c1"># epoch count</span>

<span class="n">Epoch</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Learning_rate</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_fv</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_fu</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_fxx</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_fyy</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_fxy</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_fp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_PINN</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_TOTAL</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_IC</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_WALL</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_CYLD</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_INLET</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Loss_OUTLET</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_epoch</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&#34;Epoch </span><span class="se">\t</span><span class="s2"> Learning-rate </span><span class="se">\t</span><span class="s2"> Loss_Total </span><span class="se">\t</span><span class="s2"> Loss_PINN </span><span class="se">\t</span><span class="s2"> Loss_IC </span><span class="se">\t</span><span class="s2"> Loss_WALL </span><span class="se">\t</span><span class="s2"> Loss_CYLD </span><span class="se">\t</span><span class="s2"> Loss_INLET </span><span class="se">\t</span><span class="s2"> Loss_OUTLET&#34;</span><span class="p">)</span>

    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
    <span class="n">fu</span><span class="p">,</span> <span class="n">fv</span><span class="p">,</span> <span class="n">fxx</span><span class="p">,</span> <span class="n">fyy</span><span class="p">,</span> <span class="n">fxy</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">net_f</span><span class="p">(</span><span class="n">x_c</span><span class="p">,</span> <span class="n">y_c</span><span class="p">,</span> <span class="n">t_c</span><span class="p">)</span>
    <span class="n">loss_fu</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">loss_fv</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fv</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">loss_fxx</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fxx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">loss_fyy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fyy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">loss_fxy</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fxy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">loss_fp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">loss_PINN</span> <span class="o">=</span> <span class="n">loss_fu</span> <span class="o">+</span> <span class="n">loss_fv</span> <span class="o">+</span> <span class="n">loss_fxx</span> <span class="o">+</span> <span class="n">loss_fyy</span> <span class="o">+</span> <span class="n">loss_fxy</span> <span class="o">+</span> <span class="n">loss_fp</span>
    
    <span class="n">u_ic</span><span class="p">,</span> <span class="n">v_ic</span><span class="p">,</span> <span class="n">p_ic</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">net_uvp</span><span class="p">(</span><span class="n">x_IC</span><span class="p">,</span> <span class="n">y_IC</span><span class="p">,</span> <span class="n">t_IC</span><span class="p">)</span>
    <span class="n">loss_IC</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">u_ic</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_ic</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p_ic</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">u_wall</span><span class="p">,</span> <span class="n">v_wall</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">net_uvp</span><span class="p">(</span><span class="n">x_WALL</span><span class="p">,</span> <span class="n">y_WALL</span><span class="p">,</span> <span class="n">t_WALL</span><span class="p">)</span>
<span class="c1">#    loss_WALL = torch.mean(u_wall**2) + torch.mean(v_wall**2)</span>
    <span class="n">loss_WALL</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">u_wall</span> <span class="o">-</span> <span class="n">u_WALL</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">v_wall</span> <span class="o">-</span> <span class="n">v_WALL</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">u_cyld</span><span class="p">,</span> <span class="n">v_cyld</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">net_uvp</span><span class="p">(</span><span class="n">x_CYLD</span><span class="p">,</span> <span class="n">y_CYLD</span><span class="p">,</span> <span class="n">t_CYLD</span><span class="p">)</span>
    <span class="n">loss_CYLD</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">u_cyld</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_cyld</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">u_inlet</span><span class="p">,</span> <span class="n">v_inlet</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">net_uvp</span><span class="p">(</span><span class="n">x_INLET</span><span class="p">,</span> <span class="n">y_INLET</span><span class="p">,</span> <span class="n">t_INLET</span><span class="p">)</span>
    <span class="n">loss_INLET</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">u_inlet</span> <span class="o">-</span> <span class="n">u_INLET</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">v_inlet</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">p_outlet</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">net_uvp</span><span class="p">(</span><span class="n">x_OUTLET</span><span class="p">,</span> <span class="n">y_OUTLET</span><span class="p">,</span> <span class="n">t_OUTLET</span><span class="p">)</span>
    <span class="n">loss_OUTLET</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p_outlet</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Apply zero-gradient condition at OUTLET</span>
<span class="c1">#    x_OUTLET.requres_grad = True</span>
<span class="c1">#    y_OUTLET.requres_grad = True</span>
<span class="c1">#    u_outlet, v_outlet, _, _, _, _ = model.net_uvp(x_OUTLET, y_OUTLET, t_OUTLET)</span>
<span class="c1">#    u_outlet_x = gradients(u_outlet, x_OUTLET)</span>
<span class="c1">#    v_outlet_x = gradients(v_outlet, x_OUTLET)</span>
<span class="c1">#    loss_OUTLET = torch.mean(u_outlet_x**2) + torch.mean(v_outlet_x**2)</span>

    <span class="n">loss_TOTAL</span> <span class="o">=</span> <span class="p">(</span><span class="n">loss_PINN</span> <span class="o">+</span> <span class="n">loss_IC</span> <span class="o">+</span> <span class="n">loss_CYLD</span> <span class="o">+</span> <span class="n">loss_OUTLET</span><span class="p">)</span> <span class="o">*</span> <span class="n">Lamb_ot</span> <span class="o">+</span> <span class="p">(</span><span class="n">loss_WALL</span> <span class="o">+</span> <span class="n">loss_INLET</span><span class="p">)</span> <span class="o">*</span> <span class="n">Lamb_iw</span>

    <span class="n">loss_TOTAL</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Epoch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">Learning_rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scheduler</span><span class="o">.</span><span class="n">get_last_lr</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Loss_fu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_fu</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_fv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_fv</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_fxx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_fxx</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_fyy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_fyy</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_fxy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_fxy</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_fp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_fp</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_PINN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_PINN</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_TOTAL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_TOTAL</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_IC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_IC</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_WALL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_WALL</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_CYLD</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_CYLD</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_INLET</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_INLET</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
        <span class="n">Loss_OUTLET</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_OUTLET</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>

        <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span>
              <span class="n">format</span><span class="p">(</span><span class="n">scheduler</span><span class="o">.</span><span class="n">get_last_lr</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&#34;.4E&#34;</span><span class="p">),</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span>
              <span class="n">format</span><span class="p">(</span><span class="n">loss_TOTAL</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&#34;.4E&#34;</span><span class="p">),</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span>
              <span class="n">format</span><span class="p">(</span><span class="n">loss_PINN</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&#34;.4E&#34;</span><span class="p">),</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span>
              <span class="n">format</span><span class="p">(</span><span class="n">loss_IC</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&#34;.4E&#34;</span><span class="p">),</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span>
              <span class="n">format</span><span class="p">(</span><span class="n">loss_WALL</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&#34;.4E&#34;</span><span class="p">),</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span>
              <span class="n">format</span><span class="p">(</span><span class="n">loss_CYLD</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&#34;.4E&#34;</span><span class="p">),</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span>
              <span class="n">format</span><span class="p">(</span><span class="n">loss_INLET</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&#34;.4E&#34;</span><span class="p">),</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span>
              <span class="n">format</span><span class="p">(</span><span class="n">loss_OUTLET</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&#34;.4E&#34;</span><span class="p">),</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">&#34;</span><span class="p">,</span>
             <span class="p">)</span>
</code></pre></div><p>Comment out the non-slip condition on the wall and the zero velocity gradient at OUTLET.</p>
<h4 id="timer-is-stopped-because-the-learning-loop-has-ended">Timer is stopped because the learning loop has ended.</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">processing_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;#&#34;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;processing_time(sec): &#34;</span><span class="p">,</span> <span class="n">processing_time</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;#&#34;</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div><h4 id="visualize-losses">Visualize losses</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># Draw loss curves</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Epoch</span><span class="p">,</span> <span class="n">Loss_TOTAL</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Total loss&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Epoch</span><span class="p">,</span> <span class="n">Loss_PINN</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PINN loss&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Epoch</span><span class="p">,</span> <span class="n">Loss_IC</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;IC loss&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Epoch</span><span class="p">,</span> <span class="n">Loss_WALL</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;WALL loss&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Epoch</span><span class="p">,</span> <span class="n">Loss_INLET</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;INLET loss&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Epoch</span><span class="p">,</span> <span class="n">Loss_OUTLET</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;OUTLET loss&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;epoch&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;loss&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;loss curves and learning rate&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;14&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Epoch</span><span class="p">,</span> <span class="n">Learning_rate</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Learning Rate&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Learning Rate&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div><h4 id="visulalize-velocity-and-pressure-fields">Visulalize velocity and pressure fields</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># File output function</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;rainbow&#39;</span>
<span class="n">marker</span><span class="o">=</span> <span class="s1">&#39;o&#39;</span>
<span class="n">s</span> <span class="o">=</span> <span class="mi">20</span>

<span class="k">def</span> <span class="nf">make_aFrame</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    i: frame number: 0-100
</span><span class="s2">    x, y: 2d computational domain
</span><span class="s2">    u, v, p: predicted u, v, p
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1">#    norm = Normalize(vmin=0, vmax=1.2)</span>
<span class="c1">#    cp = ax1.scatter(x, y, c=u, alpha=alpha, edgecolors=&#39;none&#39;, cmap=cmap, marker=marker, s=s, norm=norm)</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;u(m/s)  at {:07.03f}s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="c1">#    norm = Normalize(vmin=-0.6, vmax=0.6)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1">#    cp = ax2.scatter(x, y, c=v, alpha=alpha, edgecolors=&#39;none&#39;, cmap=cmap, marker=&#39;o&#39;, s=s, norm=norm)</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;v(m/s)  at {:07.03f}s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="c1">#    norm = Normalize(vmin=0, vmax=2.5)</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1">#    cp = ax3.scatter(x, y, c=p, alpha=alpha, edgecolors=&#39;none&#39;, cmap=cmap, marker=&#39;o&#39;, s=s, norm=norm)</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">])</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pressure(pa)  at {:07.03f}s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Speed and Pressure field at Epoch:{:06} Time:{:07.03f}s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./output/uvp_{:06}_{:07.03f}.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">output_uvp</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
    <span class="c1"># Output u, v, p at each time step</span>
    <span class="n">x_collo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">y_collo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
    <span class="n">x_collo</span><span class="p">,</span> <span class="n">y_collo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_collo</span><span class="p">,</span> <span class="n">y_collo</span><span class="p">)</span>
    <span class="n">x_collo</span> <span class="o">=</span> <span class="n">x_collo</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">y_collo</span> <span class="o">=</span> <span class="n">y_collo</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>

    <span class="c1"># Remove cylinder internals</span>
    <span class="n">dst</span> <span class="o">=</span> <span class="p">((</span><span class="n">x_collo</span> <span class="o">-</span> <span class="n">xcent</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_collo</span> <span class="o">-</span> <span class="n">ycent</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">x_collo</span> <span class="o">=</span> <span class="n">x_collo</span><span class="p">[</span><span class="n">dst</span> <span class="o">&gt;=</span> <span class="n">radi</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">y_collo</span> <span class="o">=</span> <span class="n">y_collo</span><span class="p">[</span><span class="n">dst</span> <span class="o">&gt;=</span> <span class="n">radi</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>

    <span class="n">x_collo</span> <span class="o">=</span> <span class="n">x_collo</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">y_collo</span> <span class="o">=</span> <span class="n">y_collo</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">t_collo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x_collo</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Time step loop</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="o">+</span><span class="p">(</span><span class="n">tmax</span><span class="o">-</span><span class="n">tmin</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="n">tmax</span><span class="o">-</span><span class="n">tmin</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">count</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">t_collo</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
            <span class="n">u_pred</span><span class="p">,</span> <span class="n">v_pred</span><span class="p">,</span> <span class="n">p_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_collo</span><span class="p">,</span> <span class="n">y_collo</span><span class="p">,</span> <span class="n">t_collo</span><span class="p">)</span>
            <span class="n">make_aFrame</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="n">x_collo</span><span class="p">,</span> <span class="n">y_collo</span><span class="p">,</span> <span class="n">u_pred</span><span class="p">,</span> <span class="n">v_pred</span><span class="p">,</span> <span class="n">p_pred</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div><h4 id="visualize-the-pressure-at-three-points-around-a-cylinder">Visualize the pressure at three points around a cylinder</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">output_pressures</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
    <span class="c1"># Predict the time evolution of pressure </span>
    <span class="c1"># at the pressure measurement point (virtual pressure probe)</span>
    <span class="n">t_probe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_probe</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_probe</span><span class="p">)</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_probe</span><span class="p">)</span>
    <span class="n">x1</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xcent</span><span class="o">-</span><span class="n">radi</span><span class="p">)</span>
    <span class="n">x2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xcent</span><span class="p">)</span>
    <span class="n">x3</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xcent</span><span class="o">+</span><span class="n">radi</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_probe</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_probe</span><span class="p">)</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">t_probe</span><span class="p">)</span>
    <span class="n">y1</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">ycent</span><span class="p">)</span>
    <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">ycent</span><span class="o">+</span><span class="n">radi</span><span class="p">)</span>
    <span class="n">y3</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">ycent</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">x3</span> <span class="o">=</span> <span class="n">x3</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">y2</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="n">y3</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>
    <span class="n">t_probe</span> <span class="o">=</span> <span class="n">t_probe</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:,</span> <span class="bp">None</span><span class="p">]</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">t_probe</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t_probe</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">t_probe</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_probe</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;at P1(front-end of cylinder)&#39;</span><span class="p">)</span>
<span class="c1">#    ax1.set_ylim([-0.5, 2.5])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time(s)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure(Pa)&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_probe</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;at P2(upper-end of cylinder)&#39;</span><span class="p">)</span> 
<span class="c1">#    ax2.set_ylim([-0.5, 2.5])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time(s)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure(Pa)&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_probe</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;at P3(back-end of cylinder)&#39;</span><span class="p">)</span>
<span class="c1">#    ax3.set_ylim([-0.5, 2.5])</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time(s)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure(Pa)&#39;</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Pressure time histories at Epoch:{:06}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./output/pressure_{:06}.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</code></pre></div><h4 id="可視化関数を呼び出す">可視化関数を呼び出す</h4>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1"># output the currnet state of p_NET()</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;./output&#39;</span><span class="p">)</span>
<span class="n">output_pressures</span><span class="p">(</span><span class="n">num_epoch</span><span class="p">)</span>
<span class="n">output_uvp</span><span class="p">(</span><span class="n">num_epoch</span><span class="p">)</span>
</code></pre></div><h2 id="visualize">Visualize</h2>
<h4 id="loss-cureves">Loss cureves</h4>
<p><img src="/images/20250321_2D_FlowOverCylinder/20250314_016_LossCurve.png" alt="LossCurve"></p>
<p>上のグラフからも分かるように、4000から11000エポックまで、WALLとINLETの誤差が1.0に留まったままとなっている。この現象は、隠れ層が深くなると（例えば50ノード・25層で）、20000エポックを過ぎても収束傾向が見られなかった。</p>
<h4 id="velocity-and-pressure-fields-after-100000-epoch">Velocity and pressure fields after 100,000 epoch</h4>
<p>This is a movie (gif file) of the png files of the velocity and pressure fields run at epoch=100000. (The original file was 13.8 MB, so it was compressed to a smaller size.)</p>
<p><img src="/images/20250321_2D_FlowOverCylinder/uvp_resize_compress.gif" alt="uvp_resize_compress"></p>
<h4 id="velocity-and-pressure-fields-of-less-than-100000-epoch">Velocity and pressure fields of less than 100,000 epoch</h4>
<p>As can be seen from the loss curves, the loss seemed to converge after 20,000 cycles, so the results of training at 20,000 and 50,000 cycles are shown below. This is a snapshot at the end of the simulation (after 60 seconds).</p>
<h5 id="20000-epoch">20,000 epoch</h5>
<p><img src="/images/20250321_2D_FlowOverCylinder/uvp_020000_060.000.png" alt="uvp20K"></p>
<h5 id="50000-epoch">50,000 epoch</h5>
<p><img src="/images/20250321_2D_FlowOverCylinder/uvp_050000_060.000.png" alt="uvp50K"></p>
<p>Notice the pressure field. The slope (gradient) of the pressure field approaches 0 toward the x-axis direction, but this trend is not seen at 20,000 and 50,000 epoch.</p>
<h2 id="summary">Summary</h2>
<p>The reason I chose 2D flow over a cylinder as my assignment was to see a Kalman vortex (vortex shedding) behind the cylinder, However, I learned that vortices are not possible with PINNs, as described in <a href="https://akenji3.github.io/en/post/20250124_karmanvortex/">Kalman vortex with OpenFOAM</a>. If so, I was going to build a simulation environment (code) with PINNs, even though vortices are not possible, in order to investigate and follow up on future research in the world.</p>
<p>The issue with my simulation results is that the nose in front of the cylinder (INLET direction) can be created compared to the flow prior in time to the vortex generation in OpenFoam. This was not improved by increasing the number of hidden layers, a trend that indicated convergence difficulties.</p>
<p>It was also found that even though the error curve appeared to converge, the pressure field required a large increase in the number of epochs before showing the expected results.</p>
<p>Perplexity and notebookLM were very useful in researching various related information on the Internet, with Perplexity playing the role of a scout who accesses papers on the Internet, and notebookLM playing the role of a staff member who learns the outline of the contents of the paper and then examines the details of the paper. I think that notebookLM has reduced the time to understand the content of English papers by an order of magnitude or more.</p>

        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20250321_2d_flowovercylinder%2f&amp;text=Simulation%20of%202D%20flow%20over%20cylinder&amp;via=akenji3" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20250321_2d_flowovercylinder%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20250321_2d_flowovercylinder%2f&amp;title=Simulation%20of%202D%20flow%20over%20cylinder" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20250321_2d_flowovercylinder%2f&amp;title=Simulation%20of%202D%20flow%20over%20cylinder" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20250321_2d_flowovercylinder%2f&amp;title=Simulation%20of%202D%20flow%20over%20cylinder" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fakenji3.github.io%2fen%2fpost%2f20250321_2d_flowovercylinder%2f&amp;description=Simulation%20of%202D%20flow%20over%20cylinder" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://akenji3.github.io/en/post/20250128_deepseek-ca/" data-toggle="tooltip" data-placement="top" title="Using LLM based on DeepSeek-R1-Distill-Qwen-14B/32B with additional Japanese language training">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://akenji3.github.io/en/post/20250325_ubuntu2404/" data-toggle="tooltip" data-placement="top" title="Install ubuntu 24.04 LTS">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:akenji.1118@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.facebook.com/arai.kenji3" title="Facebook">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-facebook fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/akenji3" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/akenji3" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/kenji-arai-0547aa1a4" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Kenji Arai
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2025
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://akenji3.github.io/en/">akenji&#39;s lab</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.74.3</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://akenji3.github.io/js/main.js"></script>
<script src="https://akenji3.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://akenji3.github.io/js/load-photoswipe.js"></script>








<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$']]
  }
});
</script>


    
  </body>
</html>

